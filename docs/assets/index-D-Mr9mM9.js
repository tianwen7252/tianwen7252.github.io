import{r as e,C as S,ad as C,a1 as n,a2 as a,a3 as j}from"./vendor-BMtVWkdh.js";import{S as ge}from"./StickyHeader-CPhcGxsU.js";import{A as Ce,O as $,D as U,u as be,h as Se,s as ye,m as Oe,d as G,a as De,t as ve,b as ke,k as we,K as Te,c as Ee,e as Re,l as Ae}from"./index-DMN5WkFw.js";import{S as H,B as y,a as c,h as _e,j as xe,d as O,i as Y,P as Ie,F as Pe,k as ze}from"./antd-KrJE-QeB.js";import{bs as Le,bj as Fe,bk as Ke}from"./antd-deps-BNgUvvwQ.js";import"./mathjs-BiAxHkVp.js";const{RangePicker:Me}=ze,Be=()=>{const[s,D]=e.useState(),[v,k]=e.useState([]),[i,w]=e.useState(0),[u,T]=e.useState(0),[h,E]=e.useState(0),[R,A]=e.useState(!1),[_,x]=e.useState(!1),[I,Z]=e.useState(!1),[q,J]=e.useState(!0),[P,Q]=e.useState(0),[z,L]=e.useState(""),{appEvent:d}=e.useContext(Ce),f=!(s!=null&&s.length),b=e.useMemo(()=>{const t=S.tz(),r=t.startOf("day"),l=t.endOf("day"),o=r.add(-1,"d");return[{label:"今天",value:[r,l]},{label:"昨天",value:[o,o.endOf("day")]},{label:"2天內",value:[o,l]},{label:"7天前",value:[r.add(-7,"d"),l]},{label:"14天內",value:[r.add(-14,"d"),l]},{label:"1個月內",value:[r.add(-30,"d"),l]}]},[]),V=e.useCallback(()=>{A(!0)},[]),W=e.useCallback(()=>{A(!1)},[]),F=e.useCallback(()=>{document.body.classList.add("resta--hidden-scroll"),x(!0)},[]),K=e.useCallback(()=>{document.body.classList.remove("resta--hidden-scroll"),x(!1),d.fire(d.ORDER_AFTER_ACTION)},[d]),X=e.useCallback(t=>{if(t){const[r,l]=t;b.some(({label:g,value:B})=>{const N=B[0].valueOf()===r.valueOf()&&B[1].valueOf()===l.valueOf();return N&&L(g),N})||L(""),D(t)}},[b]),ee=e.useCallback(C(t=>{k(t)},300),[]),te=e.useCallback(C(t=>{w(t)},500),[]),ae=e.useCallback(C(t=>{T(t)}),[]),re=e.useCallback(C(t=>{E(t)}),[]),se=e.useCallback(()=>{Z(t=>!t)},[]),le=e.useCallback(()=>{J(t=>!t)},[]),ne=e.useCallback(t=>{Q((t-1)*$)},[]),oe=e.useCallback((t,{from:r})=>r?Math.abs(t.diff(r,"day"))>31:!1,[]),ce=e.useCallback(()=>{D([]),k([]),w(0),T(0),E(0)},[]),p=e.useRef({}),de=e.useCallback(t=>(p.current={},t.filter(({total:r,createdAt:l})=>{const o=S.tz(l).format(U),g=p.current[o]=p.current[o]??{ordersSum:0,total:0};return g.total+=r,++g.ordersSum,!(i&&i&&r<i)}).filter(({createdAt:r})=>{if(u||h){const l=S.tz(r).format(U),o=p.current[l];if(o&&(u&&o.total<u||h&&o.ordersSum<h))return!1}return!0})),[i,u,h]),ie=e.useMemo(()=>{var t;return(t=s==null?void 0:s.map)==null?void 0:t.call(s,r=>r.valueOf())},[s]),{periodsOrder:m,orderListElement:ue,anchorElement:he,summaryElement:fe,totalDays:pe,callOrderAPI:me}=be({datetime:s!=null&&s.length?ie:"today",searchData:v,dateOrder:q,searchUI:!1,reverse:!1,offset:P,handleRecords:de});e.useEffect(()=>{const t=d.on(d.KEYBOARD_ON_ACTION,r=>{const{action:l}=r.detail;l==="edit"&&F()});return()=>t()},[d,F]),e.useEffect(()=>{setTimeout(()=>{window.scroll({top:0,left:0,behavior:"smooth"})},200)},[P]),e.useEffect(()=>()=>{window.scroll({top:0,left:0,behavior:"smooth"})},[]);const M=m.length;return n(j,{children:[a(ge,{cls:Se,children:n(H,{size:60,children:[a(y,{css:ye,type:"text",icon:a(Le,{}),onClick:V,children:"訂單搜尋"}),M?n("h2",{children:[M===1?m[0]:[m[0],m.at(-1)??""].join(" ~ "),z&&` (${z})`]}):a("h2",{children:"今天"})]})}),n(c,{css:Oe,gap:"middle",vertical:!0,children:[a(Y,{css:G,rootClassName:"resta-orderlist-search-drawer",title:a(j,{children:a(y,{icon:a(Fe,{}),type:"text",onClick:ce,children:"重設"})}),getContainer:!1,placement:"left",open:R,mask:!0,onClose:W,children:n(c,{vertical:!0,gap:"large",children:[n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"日期"}),a(Me,{showNow:!0,inputReadOnly:!0,presets:b,showTime:I,format:De,placeholder:["開始日期","結束日期"],size:"large",value:s,disabledDate:oe,onChange:X,renderExtraFooter:()=>a(y,{css:ve,type:"text",onClick:se,children:I?"關閉時間":"指定時間"})})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"關鍵字"}),a(_e,{placeholder:"找什麼呢?",mode:"tags",size:"large",style:{width:"100%"},allowClear:!0,onKeyUp:t=>{t.preventDefault(),t.stopPropagation()},options:ke,disabled:f,value:v,onChange:ee})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"日期排序"}),a(xe,{checkedChildren:"反序",unCheckedChildren:"正序",defaultChecked:!0,onChange:le})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"單筆金額大於"}),a(O,{size:"large",type:"number",prefix:"$",style:{width:"60%"},disabled:f,value:i,onChange:te})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"當日營業額大於"}),a(O,{size:"large",type:"number",prefix:"$",style:{width:"60%"},disabled:f,value:u,onChange:ae})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"當日訂單數量大於"}),a(O,{size:"large",type:"number",style:{width:"60%"},disabled:f,value:h,onChange:re})]})]})}),a(Y,{css:[G,we],title:n(H,{children:[a(Ke,{}),a("label",{children:"編輯訂單"})]}),placement:"right",open:_,mask:!0,onClose:K,width:820,forceRender:!0,children:a(Te,{drawerMode:!0,callOrderAPI:me,submitCallback:K})}),n("div",{css:[Ee,(R||_)&&Re],children:[he,a("div",{css:Ae,children:fe}),a(c,{wrap:!0,children:ue}),a(Ie,{hideOnSinglePage:!0,total:pe,defaultPageSize:$,onChange:ne})]}),a(Pe.BackTop,{visibilityHeight:100})]})]})},Ye=Be;export{Be as Component,Ye as OrderList,Ye as default};
