var Ut=Object.defineProperty;var Mt=(r,t,e)=>t in r?Ut(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var v=(r,t,e)=>Mt(r,typeof t!="symbol"?t+"":t,e);import{g as T,A as ft,r as z,a as o,j as R,F as J,L as Pt,M as Nt,x as Bt,N as Lt}from"./index-kGKDhl3W.js";import{r as h,R as Ht}from"./react-DQrQyBkK.js";import{S as jt}from"./StickyHeader-6peO1bdv.js";import{x as mt,M as Vt,I as Y,V as W,B as S,o as ot,k as yt,F as Ft,m as zt,z as C,W as st,X as rt,p as nt,Y as bt,Z as X,$ as q,y as O,a0 as D,S as it,g as Jt,a1 as Yt,a2 as Wt,a3 as Xt,a4 as Kt,a5 as Qt}from"./antd-C_wWPMMy.js";import{d as K,c as at,s as Zt,g as Gt}from"./lodash-EY-pETZd.js";import"./mathjs-DpHHTsW9.js";const G={product:{}},te={storage:G,updateStorage:()=>{},setInitialStorage:r=>{}},gt=h.createContext(te),ee=T`
  padding: 20px;
`,Q=T`
  margin-bottom: 20px;
`,oe=T`
  float: right;
`;T`
  margin-bottom: 16px;
`;T`
  width: 100%;
  margin-bottom: 16px;
`;T`
  width: 100%;
  margin-bottom: 16px;
`;const se=T`
  margin-bottom: 40px;
  .ant-table-thead > tr > th {
    background: #f1fafe;
  }
`,ct=T`
  margin-top: 20px;
  margin-bottom: 30px;

  .ant-table-thead > tr > th {
    background: #f0f9f3;
  }
`,re=T`
  margin-top: 20px;
  margin-bottom: 20px;

  .ant-table-thead > tr > th {
    background: #fef4cb66;
  }
`,B=T`
  margin-right: 10px;
`,lt=T`
  margin-left: 10px;
`,ne=T`
  margin-top: 40px;
  padding: 20px;
`,L=r=>{var e;const t=r.closest(".ant-table-row");return Array.from(((e=t==null?void 0:t.parentElement)==null?void 0:e.childNodes)??[]).indexOf(t)},ie=()=>{const{API:r}=h.useContext(ft),{storage:t,updateStorage:e,setInitialStorage:s}=h.useContext(gt),[n,a]=h.useState(""),[u,f]=mt.useNotification(),[b,p]=Vt.useModal(),[I,M]=h.useReducer(d=>!d,!0),P=h.useRef("1");h.useLayoutEffect(()=>{if(n){const[d,m,w]=n.split(":");setTimeout(()=>{var i,c,_,k;const l=document.getElementById(d).querySelectorAll(".ant-table-tbody > tr");if(l.length&&l[w]){const g=l[w];g.childNodes.forEach(y=>{y.classList.remove("ant-table-cell-row-hover")}),m==="up"?(c=(i=g==null?void 0:g.previousSibling)==null?void 0:i.childNodes)==null||c.forEach(y=>{y.classList.add("ant-table-cell-row-hover")}):(k=(_=g==null?void 0:g.nextSibling)==null?void 0:_.childNodes)==null||k.forEach(y=>{y.classList.add("ant-table-cell-row-hover")})}},100)}},[n]);const x=h.useCallback((d=!1)=>{d&&M(),e()},[e]),E=z(async()=>{const d=await r.commondityTypes.get();return t.product.commondityTypes=d,s("product.commondityTypes"),d.map(m=>({key:m.id,...m}))},[],[]),F=h.useCallback(K((d,m)=>{t.product.commondityTypes.some(w=>w.id===d?(w.label=m.target.value,x(),!0):!1)},300),[x]),It=h.useMemo(()=>[{title:"編號",dataIndex:"typeID",key:"typeID"},{title:"種類",dataIndex:"label",key:"label",render:(d,m)=>o(Y,{defaultValue:m.label,style:{width:200},onChange:F.bind(null,m.id)},m.id)}],[F]),vt=z(async()=>{const d=await r.commondity.get();t.product.commondities=d,s("product.commondities")},[],[]),$=h.useCallback(K((d,m,w,l)=>{const{commondities:i}=t.product,c=i.find(k=>k.id===d),{typeID:_}=c;if(c){const k=l==null?void 0:l.target,g="resta-settings-commondity-tabs";switch(m){case"edit":{const y=(k==null?void 0:k.value)??l;c[w]=y,x();break}case"delete":{c.id.toString().includes("new-")?t.product.commondities=i.filter(y=>y.id!==d):c.onMarket="0",x(!0);break}case"moveUp":{const y=i.find(A=>A.priority===c.priority-1&&A.typeID===_);if(y){++y.priority,--c.priority;const A=L(k);x(!0),a(`${g}:up:${A}`)}break}case"moveDown":{const y=i.find(A=>A.priority===c.priority+1&&A.typeID===_);if(y){--y.priority,++c.priority;const A=L(k);x(!0),a(`${g}:down:${A}`)}break}}}},150),[]),St=h.useMemo(()=>{var w;const d=[{title:"順序",dataIndex:"priority",key:"priority"},{title:"品名",dataIndex:"name",key:"name",render:(l,i)=>o(Y,{defaultValue:i.name,onChange:$.bind(null,i.id,"edit","name")},i.id)},{title:"價格",dataIndex:"price",key:"price",render:(l,i)=>o(zt,{type:"number",defaultValue:i.price,onChange:$.bind(null,i.id,"edit","price")},i.id)},{title:"鍵盤顯示",dataIndex:"hideOnMode",key:"hideOnMode",render:(l,i)=>R(C,{defaultValue:i.hideOnMode||"",style:{width:140},onChange:c=>$(i.id,"edit","hideOnMode",c),children:[o(C.Option,{value:"",children:"皆顯示"}),o(C.Option,{value:"calculator",children:"僅顯示在計算機"}),o(C.Option,{value:"commondity",children:"僅顯示在商品"}),o(C.Option,{value:"both",children:"皆不顯示"})]})},{title:"設定",key:"action",render:(l,i)=>R(J,{children:[o(S,{css:B,type:"text",variant:"filled",color:"primary",icon:o(st,{}),onClick:$.bind(null,i.id,"moveUp",null)}),o(S,{css:B,type:"text",variant:"filled",color:"primary",icon:o(rt,{}),onClick:$.bind(null,i.id,"moveDown",null)}),o(S,{css:lt,type:"text",variant:"filled",color:"danger",icon:o(nt,{}),onClick:$.bind(null,i.id,"delete",null)})]})}],m={};return(w=t.product.commondities)==null||w.forEach(l=>{const{id:i,typeID:c,priority:_,onMarket:k}=l;m[c]=m[c]??[],k==="1"&&m[c].push({key:`${i}-${_}`,...l})}),(E==null?void 0:E.map(l=>{const{id:i,label:c,typeID:_}=l,k=m[_]??[];return k.sort((g,y)=>g.priority-y.priority),{key:i,label:c,children:o(W,{bordered:!1,css:ct,dataSource:k,columns:d,pagination:!1})}}))??[]},[E,$,vt,I]),Et=h.useCallback(()=>{var l,i;const d=P.current,{commondities:m}=t.product,w=m.filter(c=>c.typeID===d).sort((c,_)=>c.priority-_.priority);if(w){const c=w.at(-1).priority+1;m.push({hideOnMode:"",id:`new-${Date.now()}`,name:"",onMarket:"1",price:0,priority:c,editor:"admin",typeID:d}),x(!0),window.scroll({top:((i=(l=document.getElementById("resta-settings-commondity-tabs"))==null?void 0:l.getBoundingClientRect())==null?void 0:i.bottom)-document.body.getBoundingClientRect().top-150,left:0,behavior:"smooth"})}},[t.product,x]),At=z(async()=>{const d=await r.orderTypes.get();t.product.orderTypes=d,s("product.orderTypes")},[],[]),U=h.useCallback(K((d,m,w,l)=>{const{orderTypes:i}=t.product,c=i.find(_=>_.id===d);if(c){const _=l==null?void 0:l.target,k="resta-settings-orderTypes-table";switch(m){case"edit":{const g=(_==null?void 0:_.value)??l;c[w]=g,x();break}case"delete":{t.product.orderTypes=i.filter(g=>g.id!==d),x(!0);break}case"moveUp":{const g=i.find(y=>y.priority===c.priority-1);if(g){++g.priority,--c.priority;const y=L(_);x(!0),a(`${k}:up:${y}`)}break}case"moveDown":{const g=i.find(y=>y.priority===c.priority+1);if(g){--g.priority,++c.priority;const y=L(_);x(!0),a(`${k}:down:${y}`)}break}}}},150),[]),[qt,Ot]=h.useMemo(()=>{var w;const d=[{title:"順序",dataIndex:"priority",key:"priority"},{title:"名稱",dataIndex:"name",key:"name",render:(l,i)=>o(Y,{defaultValue:i.name,onChange:U.bind(null,i.id,"edit","name")},i.id)},{title:"顏色",dataIndex:"color",key:"color",render:(l,i)=>R(C,{defaultValue:i.color??"",style:{width:120},onChange:c=>U(i.id,"edit","color",c),children:[o(C.Option,{value:"",children:"無"}),o(C.Option,{value:"red",children:"紅色"}),o(C.Option,{value:"blue",children:"藍色"}),o(C.Option,{value:"purple",children:"紫色"}),o(C.Option,{value:"gold",children:"金色"}),o(C.Option,{value:"brown",children:"咖啡色"})]},i.id)},{title:"設定",key:"action",render:(l,i)=>R(J,{children:[o(S,{css:B,type:"text",variant:"filled",color:"primary",icon:o(st,{}),onClick:U.bind(null,i.id,"moveUp",null)}),o(S,{css:B,type:"text",variant:"filled",color:"primary",icon:o(rt,{}),onClick:U.bind(null,i.id,"moveDown",null)}),o(S,{css:lt,type:"text",variant:"filled",color:"danger",icon:o(nt,{}),onClick:U.bind(null,i.id,"delete",null)})]})}],m=((w=t.product.orderTypes)==null?void 0:w.map(l=>({...l,key:l.id})).sort((l,i)=>l.priority-i.priority))??[];return[d,m]},[At,U,I]),Dt=h.useCallback(()=>{var w,l;const{orderTypes:d}=t.product;if(d.length>=10){u.warning({message:"系統設定",description:"訂單分類最多只能10個",showProgress:!0});return}const m=d.sort((i,c)=>i.priority-c.priority);if(m){const i=m.at(-1).priority+1;d.push({id:`new-${Date.now()}`,name:"",priority:i,editor:"admin",type:"order"}),x(!0),window.scroll({top:((l=(w=document.getElementById("resta-settings-orderTypes-table"))==null?void 0:w.getBoundingClientRect())==null?void 0:l.bottom)-document.body.getBoundingClientRect().top-100,left:0,behavior:"smooth"})}},[t.product,u,x]),$t=h.useCallback(d=>{P.current=d},[]);return R("div",{css:ee,children:[f,p,o("h2",{css:Q,children:"商品種類"}),o(W,{bordered:!1,css:se,dataSource:E,columns:It,pagination:!1}),o("h2",{css:Q,children:"商品設定"}),o(yt,{id:"resta-settings-commondity-tabs",items:St,css:ct,tabBarExtraContent:o(S,{icon:o(ot,{}),onClick:Et,children:"新增商品"}),onChange:$t}),R("h2",{css:Q,children:["訂單分類",o(S,{css:oe,icon:o(ot,{}),onClick:Dt,children:"新增分類"})]}),o(W,{id:"resta-settings-orderTypes-table",css:re,bordered:!1,dataSource:Ot,columns:qt,pagination:!1}),o(S,{css:ne,type:"primary",danger:!0,block:!0,onClick:h.useCallback(()=>{b.confirm({title:"危險動作 - 請再次確認",content:R(J,{children:[o("label",{children:"確定要還原所有商品和分類到預設狀態嗎？此操作無法復原。"}),R("h4",{children:["預設資料的最後更新日期為：",Pt]})]}),okText:"確認還原",cancelText:"取消",okType:"danger",width:500,onOk:()=>{r.reset(),setTimeout(()=>{u.success({message:"系統設定",description:"資料已還原成功，即將重新啟動App...",showProgress:!0,duration:3})},100),setTimeout(()=>{window.location.reload()},3e3)}})},[b,r,u]),children:"還原預設"}),o(Ft.BackTop,{visibilityHeight:100})]})};class dt extends Error{constructor(e,s,n){const a=e.status||e.status===0?e.status:"",u=e.statusText||"",f=`${a} ${u}`.trim(),b=f?`status code ${f}`:"an unknown error";super(`Request failed with ${b}: ${s.method} ${s.url}`);v(this,"response");v(this,"request");v(this,"options");this.name="HTTPError",this.response=e,this.request=s,this.options=n}}class wt extends Error{constructor(e){super(`Request timed out: ${e.method} ${e.url}`);v(this,"request");this.name="TimeoutError",this.request=e}}const N=r=>r!==null&&typeof r=="object",H=(...r)=>{for(const t of r)if((!N(t)||Array.isArray(t))&&t!==void 0)throw new TypeError("The `options` argument must be an object");return et({},...r)},xt=(r={},t={})=>{const e=new globalThis.Headers(r),s=t instanceof globalThis.Headers,n=new globalThis.Headers(t);for(const[a,u]of n.entries())s&&u==="undefined"||u===void 0?e.delete(a):e.set(a,u);return e};function j(r,t,e){return Object.hasOwn(t,e)&&t[e]===void 0?[]:et(r[e]??[],t[e]??[])}const _t=(r={},t={})=>({beforeRequest:j(r,t,"beforeRequest"),beforeRetry:j(r,t,"beforeRetry"),afterResponse:j(r,t,"afterResponse"),beforeError:j(r,t,"beforeError")}),et=(...r)=>{let t={},e={},s={};for(const n of r)if(Array.isArray(n))Array.isArray(t)||(t=[]),t=[...t,...n];else if(N(n)){for(let[a,u]of Object.entries(n))N(u)&&a in t&&(u=et(t[a],u)),t={...t,[a]:u};N(n.hooks)&&(s=_t(s,n.hooks),t.hooks=s),N(n.headers)&&(e=xt(e,n.headers),t.headers=e)}return t},ae=(()=>{let r=!1,t=!1;const e=typeof globalThis.ReadableStream=="function",s=typeof globalThis.Request=="function";if(e&&s)try{t=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type")}catch(n){if(n instanceof Error&&n.message==="unsupported BodyInit type")return!1;throw n}return r&&!t})(),ce=typeof globalThis.AbortController=="function",le=typeof globalThis.ReadableStream=="function",de=typeof globalThis.FormData=="function",Tt=["get","post","put","patch","head","delete"],ue={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},Z=2147483647,kt=Symbol("stop"),pe={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,fetch:!0},he={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,dispatcher:!0,duplex:!0,priority:!0},fe=r=>Tt.includes(r)?r.toUpperCase():r,me=["get","put","head","delete","options","trace"],ye=[408,413,429,500,502,503,504],be=[413,429,503],ut={limit:2,methods:me,statusCodes:ye,afterStatusCodes:be,maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:r=>.3*2**(r-1)*1e3},ge=(r={})=>{if(typeof r=="number")return{...ut,limit:r};if(r.methods&&!Array.isArray(r.methods))throw new Error("retry.methods must be an array");if(r.statusCodes&&!Array.isArray(r.statusCodes))throw new Error("retry.statusCodes must be an array");return{...ut,...r}};async function we(r,t,e,s){return new Promise((n,a)=>{const u=setTimeout(()=>{e&&e.abort(),a(new wt(r))},s.timeout);s.fetch(r,t).then(n).catch(a).then(()=>{clearTimeout(u)})})}async function xe(r,{signal:t}){return new Promise((e,s)=>{t&&(t.throwIfAborted(),t.addEventListener("abort",n,{once:!0}));function n(){clearTimeout(a),s(t.reason)}const a=setTimeout(()=>{t==null||t.removeEventListener("abort",n),e()},r)})}const _e=(r,t)=>{const e={};for(const s in t)!(s in he)&&!(s in pe)&&!(s in r)&&(e[s]=t[s]);return e};class V{constructor(t,e={}){v(this,"request");v(this,"abortController");v(this,"_retryCount",0);v(this,"_input");v(this,"_options");var s,n;if(this._input=t,this._options={...e,headers:xt(this._input.headers,e.headers),hooks:_t({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},e.hooks),method:fe(e.method??this._input.method),prefixUrl:String(e.prefixUrl||""),retry:ge(e.retry),throwHttpErrors:e.throwHttpErrors!==!1,timeout:e.timeout??1e4,fetch:e.fetch??globalThis.fetch.bind(globalThis)},typeof this._input!="string"&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&typeof this._input=="string"){if(this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(ce){this.abortController=new globalThis.AbortController;const a=this._options.signal??this._input.signal;a!=null&&a.aborted&&this.abortController.abort(a==null?void 0:a.reason),a==null||a.addEventListener("abort",()=>{this.abortController.abort(a.reason)}),this._options.signal=this.abortController.signal}if(ae&&(this._options.duplex="half"),this._options.json!==void 0&&(this._options.body=((n=(s=this._options).stringifyJson)==null?void 0:n.call(s,this._options.json))??JSON.stringify(this._options.json),this._options.headers.set("content-type",this._options.headers.get("content-type")??"application/json")),this.request=new globalThis.Request(this._input,this._options),this._options.searchParams){const u="?"+(typeof this._options.searchParams=="string"?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString()),f=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,u);(de&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)&&!(this._options.headers&&this._options.headers["content-type"])&&this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(f,{...this.request}),this._options)}}static create(t,e){const s=new V(t,e),n=async()=>{if(typeof s._options.timeout=="number"&&s._options.timeout>Z)throw new RangeError(`The \`timeout\` option cannot be greater than ${Z}`);await Promise.resolve();let f=await s._fetch();for(const b of s._options.hooks.afterResponse){const p=await b(s.request,s._options,s._decorateResponse(f.clone()));p instanceof globalThis.Response&&(f=p)}if(s._decorateResponse(f),!f.ok&&s._options.throwHttpErrors){let b=new dt(f,s.request,s._options);for(const p of s._options.hooks.beforeError)b=await p(b);throw b}if(s._options.onDownloadProgress){if(typeof s._options.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!le)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return s._stream(f.clone(),s._options.onDownloadProgress)}return f},u=s._options.retry.methods.includes(s.request.method.toLowerCase())?s._retry(n):n();for(const[f,b]of Object.entries(ue))u[f]=async()=>{s.request.headers.set("accept",s.request.headers.get("accept")||b);const p=await u;if(f==="json"){if(p.status===204||(await p.clone().arrayBuffer()).byteLength===0)return"";if(e.parseJson)return e.parseJson(await p.text())}return p[f]()};return u}_calculateRetryDelay(t){if(this._retryCount++,this._retryCount>this._options.retry.limit||t instanceof wt)throw t;if(t instanceof dt){if(!this._options.retry.statusCodes.includes(t.response.status))throw t;const s=t.response.headers.get("Retry-After")??t.response.headers.get("RateLimit-Reset")??t.response.headers.get("X-RateLimit-Reset")??t.response.headers.get("X-Rate-Limit-Reset");if(s&&this._options.retry.afterStatusCodes.includes(t.response.status)){let n=Number(s)*1e3;Number.isNaN(n)?n=Date.parse(s)-Date.now():n>=Date.parse("2024-01-01")&&(n-=Date.now());const a=this._options.retry.maxRetryAfter??n;return n<a?n:a}if(t.response.status===413)throw t}const e=this._options.retry.delay(this._retryCount);return Math.min(this._options.retry.backoffLimit,e)}_decorateResponse(t){return this._options.parseJson&&(t.json=async()=>this._options.parseJson(await t.text())),t}async _retry(t){try{return await t()}catch(e){const s=Math.min(this._calculateRetryDelay(e),Z);if(this._retryCount<1)throw e;await xe(s,{signal:this._options.signal});for(const n of this._options.hooks.beforeRetry)if(await n({request:this.request,options:this._options,error:e,retryCount:this._retryCount})===kt)return;return this._retry(t)}}async _fetch(){for(const s of this._options.hooks.beforeRequest){const n=await s(this.request,this._options);if(n instanceof Request){this.request=n;break}if(n instanceof Response)return n}const t=_e(this.request,this._options),e=this.request;return this.request=e.clone(),this._options.timeout===!1?this._options.fetch(e,t):we(e,t,this.abortController,this._options)}_stream(t,e){const s=Number(t.headers.get("content-length"))||0;let n=0;return t.status===204?(e&&e({percent:1,totalBytes:s,transferredBytes:n},new Uint8Array),new globalThis.Response(null,{status:t.status,statusText:t.statusText,headers:t.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(a){const u=t.body.getReader();e&&e({percent:0,transferredBytes:0,totalBytes:s},new Uint8Array);async function f(){const{done:b,value:p}=await u.read();if(b){a.close();return}if(e){n+=p.byteLength;const I=s===0?0:n/s;e({percent:I,transferredBytes:n,totalBytes:s},p)}a.enqueue(p),await f()}await f()}}),{status:t.status,statusText:t.statusText,headers:t.headers})}}/*! MIT License © Sindre Sorhus */const tt=r=>{const t=(e,s)=>V.create(e,H(r,s));for(const e of Tt)t[e]=(s,n)=>V.create(s,H(r,n,{method:e}));return t.create=e=>tt(H(e)),t.extend=e=>(typeof e=="function"&&(e=e(r??{})),tt(H(r,e))),t.stop=kt,t},Te=tt();var Rt={exports:{}},ke=h;function Ct(r,t,e){var s=typeof t=="function";ke.useEffect(function(){var n,a=!0,u=r(function(){return a});return Promise.resolve(u).then(function(f){n=f}),function(){a=!1,s&&t(n)}},s?e:t)}Rt.exports=Ct;var Re=Rt.exports.useAsyncEffect=Ct;const pt="0.0.16",Ce=T`
  .ant-card-bordered {
    border: 1px solid #ddd;
    background-image: linear-gradient(
      to right bottom,
      #ffffff,
      #fff,
      #fff,
      #fff,
      #f5f5f5
    );
  }
  .ant-statistic .ant-statistic-title {
    font-size: 0.9rem;
    color: #777;
  }
`,ht=r=>Number(r==null?void 0:r.replaceAll(".","")),Ie=Ht.memo(()=>{const[r,t]=mt.useNotification(),[e,s]=h.useState("---"),[{useage:n,percentageUsed:a,remaining:u},f]=h.useState({useage:"---",percentageUsed:"---",remaining:"---"});let b=!1;return ht(e)>ht(pt)&&(b=!0),Re(async()=>{try{const p=await Te.get(Nt).json();if(p!=null&&p.start_url){const I=p.start_url.match(/v=(.+)/);I&&s(I[1])}}catch(p){p!=null&&p.message&&r.error({message:"網路資料錯誤",description:`取得最新版本失敗: ${p.message}`,duration:20,showProgress:!0})}try{const{useage:p,percentageUsed:I,remaining:M}=await Bt();f({useage:p,percentageUsed:I,remaining:M})}catch{}},[r]),R("div",{css:Ce,children:[t,b&&o(bt,{style:{margin:"12px 0"},message:"請重開App將自動更新到最新版本",type:"warning",showIcon:!0}),R(X,{gutter:12,children:[o(D,{span:8,children:o(q,{children:o(O,{title:"本機App版本",prefix:"v",value:pt})})}),o(D,{span:8,children:o(q,{children:o(O,{title:"程式資料庫同步版本",value:Lt})})}),o(D,{span:8,children:o(q,{children:o(O,{title:"本機資料庫同步版本",value:localStorage.getItem("SYNC_NUMBER")})})})]}),R(X,{gutter:12,style:{marginTop:12},children:[o(D,{span:8,children:o(q,{children:o(O,{title:"最新App版本",prefix:"v",value:e})})}),o(D,{span:8,children:o(q,{children:o(O,{title:"雲端資料同步版本",value:"---"})})}),o(D,{span:8,children:o(q,{children:o(O,{title:"本機雲端資料同步版本",value:localStorage.getItem("CLOUD_SYNC_NUMBER")??"---"})})})]}),R(X,{gutter:12,style:{marginTop:12},children:[o(D,{span:8,children:o(q,{children:o(O,{title:"本機資料庫使用量",value:n})})}),o(D,{span:8,children:o(q,{children:o(O,{title:"本機資料庫剩餘量",value:u})})}),o(D,{span:8,children:o(q,{children:o(O,{title:"本機資料庫使用率",value:a})})})]})]})}),ve=T`
  margin-bottom: 20px;
  font-size: 1.4rem;
  color: #6b6868;
  padding: 10px 20px;
`,Se=T`
  vertical-align: middle;
`,Ee=T`
  padding-bottom: 80px;
  h2 {
    font-weight: normal;
    color: #6b6868;
    font-size: 1.3rem;
    border-left: 6px solid #6b686891;
    border-radius: 4px;
    padding-left: 8px;
  }
  .ant-tabs .ant-tabs-tab {
    font-size: 1rem;
  }
`,Ae=T`
  padding: 0 20px;
`,qe=T`
  padding: 4px 8px;
  margin-left: 20px;
`,Oe=T`
  float: right;
  right: 60px;
  padding: 14px 8px;
  top: 5px;
  font-size: 1rem;
`,De=[{key:"info",icon:o(Yt,{}),label:"系統資訊",children:o(Ie,{})},{key:"product",icon:o(Wt,{}),label:"商品設定",children:o(ie,{})},{key:"stuff",icon:o(Xt,{}),label:"員工設定"},{key:"cost",icon:o(Kt,{}),label:"每月成本"},{key:"cloud",icon:o(Qt,{}),label:"雲端同步"}],He=()=>{const{API:r}=h.useContext(ft),t=h.useMemo(()=>({...G}),[]),e=h.useMemo(()=>at(G),[]),[s,n]=h.useState(!1),a=h.useCallback(()=>{console.log("comparison",t,e),n(JSON.stringify(t)!==JSON.stringify(e))},[t,e]),u=h.useCallback(()=>{let b=!1;const{product:{commondityTypes:p,commondities:I,orderTypes:M}}=t;p.forEach((x,E)=>{e.product.commondityTypes[E].label!==x.label&&(r.commondityTypes.set(x.id,x),b=!0)});const P=e.product.commondities;P.forEach((x,E)=>{P[E]}),b&&n(!1)},[t,e,a,r]),f=h.useMemo(()=>({storage:t,updateStorage:a,setInitialStorage:b=>{Zt(e,b,at(Gt(t,b))),console.log("init",b,t,e)}}),[t,e,a]);return o(gt.Provider,{value:f,children:R("div",{css:Ee,children:[R(jt,{cls:ve,children:[R(it,{css:Se,children:[o(Jt,{}),o("label",{children:"系統設定"}),s&&o(it,{children:o(bt,{css:qe,description:"設定尚未存檔",type:"warning",showIcon:!0})})]}),s&&o(S,{css:Oe,size:"small",type:"primary",onClick:u,children:"存檔設定 (未完成)"})]}),o("div",{css:Ae,children:o(yt,{items:De,defaultActiveKey:"info",destroyInactiveTabPane:!0})})]})})};export{He as Component,He as Settings,He as default};
