var Mt=Object.defineProperty;var Pt=(s,t,e)=>t in s?Mt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var v=(s,t,e)=>(Pt(s,typeof t!="symbol"?t+"":t,e),e);import{g as _,A as mt,r as F,a as o,j as k,F as z,L as Nt,M as Bt,x as Lt,N as Ht}from"./index-DwFgFsrx.js";import{r as h,R as jt}from"./react-CrrgmX9u.js";import{S as Vt}from"./StickyHeader-CZt5VF9O.js";import{y as yt,M as Ft,I as J,W as Y,B as S,o as rt,k as bt,F as zt,m as Jt,A as C,X as st,Y as nt,p as it,Z as gt,$ as W,a0 as A,z as q,a1 as O,S as at,g as Yt,a2 as Wt,a3 as Xt,a4 as Kt,a5 as Qt,a6 as Zt}from"./antd-Bk4piC4u.js";import{d as X,c as ct,s as Gt,g as te}from"./lodash-EY-pETZd.js";import"./mathjs-CgcXHlQa.js";const Z={product:{}},ee={storage:Z,updateStorage:()=>{},setInitialStorage:s=>{}},wt=h.createContext(ee),oe=_`
  padding: 20px;
`,K=_`
  margin-bottom: 20px;
`,re=_`
  float: right;
`;_`
  margin-bottom: 16px;
`;_`
  width: 100%;
  margin-bottom: 16px;
`;_`
  width: 100%;
  margin-bottom: 16px;
`;const se=_`
  margin-bottom: 40px;
  .ant-table-thead > tr > th {
    background: #f1fafe;
  }
`,lt=_`
  margin-top: 20px;
  margin-bottom: 30px;

  .ant-table-thead > tr > th {
    background: #f0f9f3;
  }
`,ne=_`
  margin-top: 20px;
  margin-bottom: 20px;

  .ant-table-thead > tr > th {
    background: #fef4cb66;
  }
`,B=_`
  margin-right: 10px;
`,dt=_`
  margin-left: 10px;
`,ie=_`
  margin-top: 40px;
  padding: 20px;
`,L=s=>{var e;const t=s.closest(".ant-table-row");return Array.from(((e=t==null?void 0:t.parentElement)==null?void 0:e.childNodes)??[]).indexOf(t)},ae=()=>{const{API:s}=h.useContext(mt),{storage:t,updateStorage:e,setInitialStorage:r}=h.useContext(wt),[n,a]=h.useState(""),[u,f]=yt.useNotification(),[b,p]=Ft.useModal(),[I,D]=h.useReducer(d=>!d,!0),et=h.useRef("1"),N=h.useRef(!1);h.useLayoutEffect(()=>{if(n){const[d,m,w]=n.split(":");setTimeout(()=>{var i,c,x,T;const l=document.getElementById(d).querySelectorAll(".ant-table-tbody > tr");if(l.length&&l[w]){const g=l[w];g.childNodes.forEach(y=>{y.classList.remove("ant-table-cell-row-hover")}),m==="up"?(c=(i=g==null?void 0:g.previousSibling)==null?void 0:i.childNodes)==null||c.forEach(y=>{y.classList.add("ant-table-cell-row-hover")}):(T=(x=g==null?void 0:g.nextSibling)==null?void 0:x.childNodes)==null||T.forEach(y=>{y.classList.add("ant-table-cell-row-hover")})}},100)}},[n]);const R=h.useCallback((d=!1)=>{d&&D(),e()},[e]),M=F(async()=>{if(N.current)return[];const d=await s.commondityTypes.get();return t.product.commondityTypes=d,r("product.commondityTypes"),d.map(m=>({key:m.id,...m}))},[],[]),ot=h.useCallback(X((d,m)=>{t.product.commondityTypes.some(w=>w.id===d?(w.label=m.target.value,R(),!0):!1)},300),[R]),vt=h.useMemo(()=>[{title:"編號",dataIndex:"typeID",key:"typeID"},{title:"種類",dataIndex:"label",key:"label",render:(d,m)=>o(J,{defaultValue:m.label,style:{width:200},onChange:ot.bind(null,m.id)},m.id)}],[ot]),St=F(async()=>{if(N.current)return;const d=await s.commondity.get();t.product.commondities=d,r("product.commondities")},[],[]),$=h.useCallback(X((d,m,w,l)=>{const{commondities:i}=t.product,c=i.find(T=>T.id===d),{typeID:x}=c;if(c){const T=l==null?void 0:l.target,g="resta-settings-commondity-tabs";switch(m){case"edit":{const y=(T==null?void 0:T.value)??l;c[w]=y,R();break}case"delete":{c.id.toString().includes("new-")?t.product.commondities=i.filter(y=>y.id!==d):c.onMarket="0",R(!0);break}case"moveUp":{const y=i.find(E=>E.priority===c.priority-1&&E.typeID===x);if(y){++y.priority,--c.priority;const E=L(T);R(!0),a(`${g}:up:${E}`)}break}case"moveDown":{const y=i.find(E=>E.priority===c.priority+1&&E.typeID===x);if(y){--y.priority,++c.priority;const E=L(T);R(!0),a(`${g}:down:${E}`)}break}}}},150),[]),Et=h.useMemo(()=>{var w;const d=[{title:"順序",dataIndex:"priority",key:"priority"},{title:"品名",dataIndex:"name",key:"name",render:(l,i)=>o(J,{defaultValue:i.name,onChange:$.bind(null,i.id,"edit","name")},i.id)},{title:"價格",dataIndex:"price",key:"price",render:(l,i)=>o(Jt,{type:"number",defaultValue:i.price,onChange:$.bind(null,i.id,"edit","price")},i.id)},{title:"鍵盤顯示",dataIndex:"hideOnMode",key:"hideOnMode",render:(l,i)=>k(C,{defaultValue:i.hideOnMode||"",style:{width:140},onChange:c=>$(i.id,"edit","hideOnMode",c),children:[o(C.Option,{value:"",children:"皆顯示"}),o(C.Option,{value:"calculator",children:"僅顯示在計算機"}),o(C.Option,{value:"commondity",children:"僅顯示在商品"}),o(C.Option,{value:"both",children:"皆不顯示"})]})},{title:"設定",key:"action",render:(l,i)=>k(z,{children:[o(S,{css:B,type:"text",variant:"filled",color:"primary",icon:o(st,{}),onClick:$.bind(null,i.id,"moveUp",null)}),o(S,{css:B,type:"text",variant:"filled",color:"primary",icon:o(nt,{}),onClick:$.bind(null,i.id,"moveDown",null)}),o(S,{css:dt,type:"text",variant:"filled",color:"danger",icon:o(it,{}),onClick:$.bind(null,i.id,"delete",null)})]})}],m={};return(w=t.product.commondities)==null||w.forEach(l=>{const{id:i,typeID:c,priority:x,onMarket:T}=l;m[c]=m[c]??[],T==="1"&&m[c].push({key:`${i}-${x}`,...l})}),(M==null?void 0:M.map(l=>{const{id:i,label:c,typeID:x}=l,T=m[x]??[];return T.sort((g,y)=>g.priority-y.priority),{key:i,label:c,children:o(Y,{bordered:!1,css:lt,dataSource:T,columns:d,pagination:!1})}}))??[]},[M,$,St,I]),At=h.useCallback(()=>{var l,i;const d=et.current,{commondities:m}=t.product,w=m.filter(c=>c.typeID===d).sort((c,x)=>c.priority-x.priority);if(w){const c=w.at(-1).priority+1;m.push({hideOnMode:"",id:`new-${Date.now()}`,name:"",onMarket:"1",price:0,priority:c,editor:"admin",typeID:d}),R(!0),window.scroll({top:((i=(l=document.getElementById("resta-settings-commondity-tabs"))==null?void 0:l.getBoundingClientRect())==null?void 0:i.bottom)-document.body.getBoundingClientRect().top-150,left:0,behavior:"smooth"})}},[t.product,R]),qt=F(async()=>{if(N.current)return;const d=await s.orderTypes.get();t.product.orderTypes=d,r("product.orderTypes")},[],[]),U=h.useCallback(X((d,m,w,l)=>{const{orderTypes:i}=t.product,c=i.find(x=>x.id===d);if(c){const x=l==null?void 0:l.target,T="resta-settings-orderTypes-table";switch(m){case"edit":{const g=(x==null?void 0:x.value)??l;c[w]=g,R();break}case"delete":{t.product.orderTypes=i.filter(g=>g.id!==d),R(!0);break}case"moveUp":{const g=i.find(y=>y.priority===c.priority-1);if(g){++g.priority,--c.priority;const y=L(x);R(!0),a(`${T}:up:${y}`)}break}case"moveDown":{const g=i.find(y=>y.priority===c.priority+1);if(g){--g.priority,++c.priority;const y=L(x);R(!0),a(`${T}:down:${y}`)}break}}}},150),[]),[Ot,Dt]=h.useMemo(()=>{var w;const d=[{title:"順序",dataIndex:"priority",key:"priority"},{title:"名稱",dataIndex:"name",key:"name",render:(l,i)=>o(J,{defaultValue:i.name,onChange:U.bind(null,i.id,"edit","name")},i.id)},{title:"顏色",dataIndex:"color",key:"color",render:(l,i)=>k(C,{defaultValue:i.color??"",style:{width:120},onChange:c=>U(i.id,"edit","color",c),children:[o(C.Option,{value:"",children:"無"}),o(C.Option,{value:"red",children:"紅色"}),o(C.Option,{value:"blue",children:"藍色"}),o(C.Option,{value:"purple",children:"紫色"}),o(C.Option,{value:"gold",children:"金色"}),o(C.Option,{value:"brown",children:"咖啡色"})]},i.id)},{title:"設定",key:"action",render:(l,i)=>k(z,{children:[o(S,{css:B,type:"text",variant:"filled",color:"primary",icon:o(st,{}),onClick:U.bind(null,i.id,"moveUp",null)}),o(S,{css:B,type:"text",variant:"filled",color:"primary",icon:o(nt,{}),onClick:U.bind(null,i.id,"moveDown",null)}),o(S,{css:dt,type:"text",variant:"filled",color:"danger",icon:o(it,{}),onClick:U.bind(null,i.id,"delete",null)})]})}],m=((w=t.product.orderTypes)==null?void 0:w.map(l=>({...l,key:l.id})).sort((l,i)=>l.priority-i.priority))??[];return[d,m]},[qt,U,I]),$t=h.useCallback(()=>{var w,l;const{orderTypes:d}=t.product;if(d.length>=10){u.warning({message:"系統設定",description:"訂單分類最多只能10個",showProgress:!0});return}const m=d.sort((i,c)=>i.priority-c.priority);if(m){const i=m.at(-1).priority+1;d.push({id:`new-${Date.now()}`,name:"",priority:i,editor:"admin",type:"order"}),R(!0),window.scroll({top:((l=(w=document.getElementById("resta-settings-orderTypes-table"))==null?void 0:w.getBoundingClientRect())==null?void 0:l.bottom)-document.body.getBoundingClientRect().top-100,left:0,behavior:"smooth"})}},[t.product,u,R]),Ut=h.useCallback(d=>{et.current=d},[]);return k("div",{css:oe,children:[f,p,o("h2",{css:K,children:"商品種類"}),o(Y,{bordered:!1,css:se,dataSource:M,columns:vt,pagination:!1}),o("h2",{css:K,children:"商品設定"}),o(bt,{id:"resta-settings-commondity-tabs",items:Et,css:lt,tabBarExtraContent:o(S,{icon:o(rt,{}),onClick:At,children:"新增商品"}),onChange:Ut}),k("h2",{css:K,children:["訂單分類",o(S,{css:re,icon:o(rt,{}),onClick:$t,children:"新增分類"})]}),o(Y,{id:"resta-settings-orderTypes-table",css:ne,bordered:!1,dataSource:Dt,columns:Ot,pagination:!1}),o(S,{css:ie,type:"primary",danger:!0,block:!0,onClick:h.useCallback(()=>{b.confirm({title:"危險動作 - 請再次確認",content:k(z,{children:[o("label",{children:"確定要還原所有商品和分類到預設狀態嗎？此操作無法復原。"}),k("h4",{children:["預設資料的最後更新日期為：",Nt]})]}),okText:"確認還原",cancelText:"取消",okType:"danger",width:500,onOk:()=>{N.current=!0,s.reset(),setTimeout(()=>{u.success({message:"系統設定",description:"資料已還原成功，即將重新啟動App...",showProgress:!0,duration:3})},100),setTimeout(()=>{window.location.reload()},3e3)}})},[b,s,u]),children:"還原預設"}),o(zt.BackTop,{visibilityHeight:100})]})};class ut extends Error{constructor(e,r,n){const a=e.status||e.status===0?e.status:"",u=e.statusText||"",f=`${a} ${u}`.trim(),b=f?`status code ${f}`:"an unknown error";super(`Request failed with ${b}: ${r.method} ${r.url}`);v(this,"response");v(this,"request");v(this,"options");this.name="HTTPError",this.response=e,this.request=r,this.options=n}}class xt extends Error{constructor(e){super(`Request timed out: ${e.method} ${e.url}`);v(this,"request");this.name="TimeoutError",this.request=e}}const P=s=>s!==null&&typeof s=="object",H=(...s)=>{for(const t of s)if((!P(t)||Array.isArray(t))&&t!==void 0)throw new TypeError("The `options` argument must be an object");return tt({},...s)},_t=(s={},t={})=>{const e=new globalThis.Headers(s),r=t instanceof globalThis.Headers,n=new globalThis.Headers(t);for(const[a,u]of n.entries())r&&u==="undefined"||u===void 0?e.delete(a):e.set(a,u);return e};function j(s,t,e){return Object.hasOwn(t,e)&&t[e]===void 0?[]:tt(s[e]??[],t[e]??[])}const Tt=(s={},t={})=>({beforeRequest:j(s,t,"beforeRequest"),beforeRetry:j(s,t,"beforeRetry"),afterResponse:j(s,t,"afterResponse"),beforeError:j(s,t,"beforeError")}),tt=(...s)=>{let t={},e={},r={};for(const n of s)if(Array.isArray(n))Array.isArray(t)||(t=[]),t=[...t,...n];else if(P(n)){for(let[a,u]of Object.entries(n))P(u)&&a in t&&(u=tt(t[a],u)),t={...t,[a]:u};P(n.hooks)&&(r=Tt(r,n.hooks),t.hooks=r),P(n.headers)&&(e=_t(e,n.headers),t.headers=e)}return t},ce=(()=>{let s=!1,t=!1;const e=typeof globalThis.ReadableStream=="function",r=typeof globalThis.Request=="function";if(e&&r)try{t=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type")}catch(n){if(n instanceof Error&&n.message==="unsupported BodyInit type")return!1;throw n}return s&&!t})(),le=typeof globalThis.AbortController=="function",de=typeof globalThis.ReadableStream=="function",ue=typeof globalThis.FormData=="function",kt=["get","post","put","patch","head","delete"],pe={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},Q=2147483647,Rt=Symbol("stop"),he={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,fetch:!0},fe={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,dispatcher:!0,duplex:!0,priority:!0},me=s=>kt.includes(s)?s.toUpperCase():s,ye=["get","put","head","delete","options","trace"],be=[408,413,429,500,502,503,504],ge=[413,429,503],pt={limit:2,methods:ye,statusCodes:be,afterStatusCodes:ge,maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:s=>.3*2**(s-1)*1e3},we=(s={})=>{if(typeof s=="number")return{...pt,limit:s};if(s.methods&&!Array.isArray(s.methods))throw new Error("retry.methods must be an array");if(s.statusCodes&&!Array.isArray(s.statusCodes))throw new Error("retry.statusCodes must be an array");return{...pt,...s}};async function xe(s,t,e,r){return new Promise((n,a)=>{const u=setTimeout(()=>{e&&e.abort(),a(new xt(s))},r.timeout);r.fetch(s,t).then(n).catch(a).then(()=>{clearTimeout(u)})})}async function _e(s,{signal:t}){return new Promise((e,r)=>{t&&(t.throwIfAborted(),t.addEventListener("abort",n,{once:!0}));function n(){clearTimeout(a),r(t.reason)}const a=setTimeout(()=>{t==null||t.removeEventListener("abort",n),e()},s)})}const Te=(s,t)=>{const e={};for(const r in t)!(r in fe)&&!(r in he)&&!(r in s)&&(e[r]=t[r]);return e};class V{constructor(t,e={}){v(this,"request");v(this,"abortController");v(this,"_retryCount",0);v(this,"_input");v(this,"_options");var r,n;if(this._input=t,this._options={...e,headers:_t(this._input.headers,e.headers),hooks:Tt({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},e.hooks),method:me(e.method??this._input.method),prefixUrl:String(e.prefixUrl||""),retry:we(e.retry),throwHttpErrors:e.throwHttpErrors!==!1,timeout:e.timeout??1e4,fetch:e.fetch??globalThis.fetch.bind(globalThis)},typeof this._input!="string"&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&typeof this._input=="string"){if(this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(le){this.abortController=new globalThis.AbortController;const a=this._options.signal??this._input.signal;a!=null&&a.aborted&&this.abortController.abort(a==null?void 0:a.reason),a==null||a.addEventListener("abort",()=>{this.abortController.abort(a.reason)}),this._options.signal=this.abortController.signal}if(ce&&(this._options.duplex="half"),this._options.json!==void 0&&(this._options.body=((n=(r=this._options).stringifyJson)==null?void 0:n.call(r,this._options.json))??JSON.stringify(this._options.json),this._options.headers.set("content-type",this._options.headers.get("content-type")??"application/json")),this.request=new globalThis.Request(this._input,this._options),this._options.searchParams){const u="?"+(typeof this._options.searchParams=="string"?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString()),f=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,u);(ue&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)&&!(this._options.headers&&this._options.headers["content-type"])&&this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(f,{...this.request}),this._options)}}static create(t,e){const r=new V(t,e),n=async()=>{if(typeof r._options.timeout=="number"&&r._options.timeout>Q)throw new RangeError(`The \`timeout\` option cannot be greater than ${Q}`);await Promise.resolve();let f=await r._fetch();for(const b of r._options.hooks.afterResponse){const p=await b(r.request,r._options,r._decorateResponse(f.clone()));p instanceof globalThis.Response&&(f=p)}if(r._decorateResponse(f),!f.ok&&r._options.throwHttpErrors){let b=new ut(f,r.request,r._options);for(const p of r._options.hooks.beforeError)b=await p(b);throw b}if(r._options.onDownloadProgress){if(typeof r._options.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!de)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return r._stream(f.clone(),r._options.onDownloadProgress)}return f},u=r._options.retry.methods.includes(r.request.method.toLowerCase())?r._retry(n):n();for(const[f,b]of Object.entries(pe))u[f]=async()=>{r.request.headers.set("accept",r.request.headers.get("accept")||b);const p=await u;if(f==="json"){if(p.status===204||(await p.clone().arrayBuffer()).byteLength===0)return"";if(e.parseJson)return e.parseJson(await p.text())}return p[f]()};return u}_calculateRetryDelay(t){if(this._retryCount++,this._retryCount>this._options.retry.limit||t instanceof xt)throw t;if(t instanceof ut){if(!this._options.retry.statusCodes.includes(t.response.status))throw t;const r=t.response.headers.get("Retry-After")??t.response.headers.get("RateLimit-Reset")??t.response.headers.get("X-RateLimit-Reset")??t.response.headers.get("X-Rate-Limit-Reset");if(r&&this._options.retry.afterStatusCodes.includes(t.response.status)){let n=Number(r)*1e3;Number.isNaN(n)?n=Date.parse(r)-Date.now():n>=Date.parse("2024-01-01")&&(n-=Date.now());const a=this._options.retry.maxRetryAfter??n;return n<a?n:a}if(t.response.status===413)throw t}const e=this._options.retry.delay(this._retryCount);return Math.min(this._options.retry.backoffLimit,e)}_decorateResponse(t){return this._options.parseJson&&(t.json=async()=>this._options.parseJson(await t.text())),t}async _retry(t){try{return await t()}catch(e){const r=Math.min(this._calculateRetryDelay(e),Q);if(this._retryCount<1)throw e;await _e(r,{signal:this._options.signal});for(const n of this._options.hooks.beforeRetry)if(await n({request:this.request,options:this._options,error:e,retryCount:this._retryCount})===Rt)return;return this._retry(t)}}async _fetch(){for(const r of this._options.hooks.beforeRequest){const n=await r(this.request,this._options);if(n instanceof Request){this.request=n;break}if(n instanceof Response)return n}const t=Te(this.request,this._options),e=this.request;return this.request=e.clone(),this._options.timeout===!1?this._options.fetch(e,t):xe(e,t,this.abortController,this._options)}_stream(t,e){const r=Number(t.headers.get("content-length"))||0;let n=0;return t.status===204?(e&&e({percent:1,totalBytes:r,transferredBytes:n},new Uint8Array),new globalThis.Response(null,{status:t.status,statusText:t.statusText,headers:t.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(a){const u=t.body.getReader();e&&e({percent:0,transferredBytes:0,totalBytes:r},new Uint8Array);async function f(){const{done:b,value:p}=await u.read();if(b){a.close();return}if(e){n+=p.byteLength;const I=r===0?0:n/r;e({percent:I,transferredBytes:n,totalBytes:r},p)}a.enqueue(p),await f()}await f()}}),{status:t.status,statusText:t.statusText,headers:t.headers})}}/*! MIT License © Sindre Sorhus */const G=s=>{const t=(e,r)=>V.create(e,H(s,r));for(const e of kt)t[e]=(r,n)=>V.create(r,H(s,n,{method:e}));return t.create=e=>G(H(e)),t.extend=e=>(typeof e=="function"&&(e=e(s??{})),G(H(s,e))),t.stop=Rt,t},ke=G();var Ct={exports:{}},Re=h;function It(s,t,e){var r=typeof t=="function";Re.useEffect(function(){var n,a=!0,u=s(function(){return a});return Promise.resolve(u).then(function(f){n=f}),function(){a=!1,r&&t(n)}},r?e:t)}Ct.exports=It;var Ce=Ct.exports.useAsyncEffect=It;const ht="0.0.13",Ie=_`
  .ant-card-bordered {
    border: 1px solid #ddd;
    background-image: linear-gradient(
      to right bottom,
      #ffffff,
      #fff,
      #fff,
      #fff,
      #f5f5f5
    );
  }
  .ant-statistic .ant-statistic-title {
    font-size: 0.9rem;
    color: #777;
  }
`,ft=s=>Number(s==null?void 0:s.replaceAll(".","")),ve=jt.memo(()=>{const[s,t]=yt.useNotification(),[e,r]=h.useState("---"),[{useage:n,percentageUsed:a,remaining:u},f]=h.useState({useage:"---",percentageUsed:"---",remaining:"---"});let b=!1;return ft(e)>ft(ht)&&(b=!0),Ce(async()=>{try{const p=await ke.get(Bt).json();if(p!=null&&p.start_url){const I=p.start_url.match(/v=(.+)/);I&&r(I[1])}}catch(p){p!=null&&p.message&&s.error({message:"網路資料錯誤",description:`取得最新版本失敗: ${p.message}`,duration:20,showProgress:!0})}try{const{useage:p,percentageUsed:I,remaining:D}=await Lt();f({useage:p,percentageUsed:I,remaining:D})}catch{}},[s]),k("div",{css:Ie,children:[t,b&&o(gt,{style:{margin:"12px 0"},message:"請重開App將自動更新到最新版本",type:"warning",showIcon:!0}),k(W,{gutter:12,children:[o(O,{span:8,children:o(A,{children:o(q,{title:"本機App版本",prefix:"v",value:ht})})}),o(O,{span:8,children:o(A,{children:o(q,{title:"程式資料庫同步版本",value:Ht})})}),o(O,{span:8,children:o(A,{children:o(q,{title:"本機資料庫同步版本",value:localStorage.getItem("SYNC_NUMBER")})})})]}),k(W,{gutter:12,style:{marginTop:12},children:[o(O,{span:8,children:o(A,{children:o(q,{title:"最新App版本",prefix:"v",value:e})})}),o(O,{span:8,children:o(A,{children:o(q,{title:"雲端資料同步版本",value:"---"})})}),o(O,{span:8,children:o(A,{children:o(q,{title:"本機雲端資料同步版本",value:localStorage.getItem("CLOUD_SYNC_NUMBER")??"---"})})})]}),k(W,{gutter:12,style:{marginTop:12},children:[o(O,{span:8,children:o(A,{children:o(q,{title:"本機資料庫使用量",value:n})})}),o(O,{span:8,children:o(A,{children:o(q,{title:"本機資料庫剩餘量",value:u})})}),o(O,{span:8,children:o(A,{children:o(q,{title:"本機資料庫使用率",value:a})})})]})]})}),Se=_`
  margin-bottom: 20px;
  font-size: 1.4rem;
  color: #6b6868;
  padding: 10px 20px;
`,Ee=_`
  vertical-align: middle;
`,Ae=_`
  padding-bottom: 80px;
  h2 {
    font-weight: normal;
    color: #6b6868;
    font-size: 1.3rem;
    border-left: 6px solid #6b686891;
    border-radius: 4px;
    padding-left: 8px;
  }
  .ant-tabs .ant-tabs-tab {
    font-size: 1rem;
  }
`,qe=_`
  padding: 0 20px;
`,Oe=_`
  padding: 4px 8px;
  margin-left: 20px;
`,De=_`
  float: right;
  right: 60px;
  padding: 14px 8px;
  top: 5px;
  font-size: 1rem;
`,$e=[{key:"info",icon:o(Wt,{}),label:"系統資訊",children:o(ve,{})},{key:"product",icon:o(Xt,{}),label:"商品設定",children:o(ae,{})},{key:"stuff",icon:o(Kt,{}),label:"員工設定"},{key:"cost",icon:o(Qt,{}),label:"每月成本"},{key:"cloud",icon:o(Zt,{}),label:"雲端同步"}],Ue=()=>{const{API:s}=h.useContext(mt),t=h.useMemo(()=>({...Z}),[]),e=h.useMemo(()=>ct(Z),[]),[r,n]=h.useState(!1),a=h.useCallback(()=>{console.log("comparison",t,e),n(JSON.stringify(t)!==JSON.stringify(e))},[t,e]),u=h.useCallback(()=>{const{product:{commondityTypes:b,commondities:p,orderTypes:I}}=t;b.forEach(D=>{s.commondityTypes.set(D.id,D)}),n(!1)},[t,e,a,s]),f=h.useMemo(()=>({storage:t,updateStorage:a,setInitialStorage:b=>{Gt(e,b,ct(te(t,b))),console.log("init",b,t,e)}}),[t,e,a]);return o(wt.Provider,{value:f,children:k("div",{css:Ae,children:[k(Vt,{cls:Se,children:[k(at,{css:Ee,children:[o(Yt,{}),o("label",{children:"系統設定"}),r&&o(at,{children:o(gt,{css:Oe,description:"設定尚未存檔",type:"warning",showIcon:!0})})]}),r&&o(S,{css:De,size:"small",type:"primary",onClick:u,children:"存檔設定 (未完成)"})]}),o("div",{css:qe,children:o(bt,{items:$e,defaultActiveKey:"info",destroyInactiveTabPane:!0})})]})})},Ve=Ue;export{Ue as Component,Ve as Settings,Ve as default};
