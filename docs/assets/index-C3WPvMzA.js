import{A as ge,O as j,D as $,u as Ce,j as n,a,h as be,s as Se,m as ye,d as H,F as U,b as De,t as Oe,c as ve,k as ke,K as we,e as Te,f as Ee,l as Re}from"./index-BMXlYxi-.js";import{r as e}from"./react-DQrQyBkK.js";import{b as S,S as G,B as y,H as Ae,i as c,h as _e,z as xe,J as Ie,m as D,C as Y,j as Pe,P as ze,F as Fe,K as Ke}from"./antd-DbVoGr1G.js";import{S as Me}from"./StickyHeader-CUVbBqsJ.js";import{d as C}from"./lodash-EY-pETZd.js";import"./mathjs-JIS0MRwP.js";const{RangePicker:Be}=Ke,Ge=()=>{const[s,O]=e.useState(),[v,k]=e.useState([]),[d,w]=e.useState(0),[u,T]=e.useState(0),[h,E]=e.useState(0),[R,A]=e.useState(!1),[_,x]=e.useState(!1),[I,J]=e.useState(!1),[Z,q]=e.useState(!0),[P,Q]=e.useState(0),[z,F]=e.useState(""),{appEvent:i}=e.useContext(ge),f=!(s!=null&&s.length),b=e.useMemo(()=>{const t=S.tz(),r=t.startOf("day"),l=t.endOf("day"),o=r.add(-1,"d");return[{label:"今天",value:[r,l]},{label:"昨天",value:[o,o.endOf("day")]},{label:"2天內",value:[o,l]},{label:"7天前",value:[r.add(-7,"d"),l]},{label:"14天內",value:[r.add(-14,"d"),l]},{label:"1個月內",value:[r.add(-30,"d"),l]}]},[]),V=e.useCallback(()=>{A(!0)},[]),W=e.useCallback(()=>{A(!1)},[]),K=e.useCallback(()=>{document.body.classList.add("resta--hidden-scroll"),x(!0)},[]),M=e.useCallback(()=>{document.body.classList.remove("resta--hidden-scroll"),x(!1),i.fire(i.ORDER_AFTER_ACTION)},[i]),X=e.useCallback(t=>{if(t){const[r,l]=t;b.some(({label:g,value:L})=>{const N=L[0].valueOf()===r.valueOf()&&L[1].valueOf()===l.valueOf();return N&&F(g),N})||F(""),O(t)}},[b]),ee=e.useCallback(C(t=>{k(t)},300),[]),te=e.useCallback(C(t=>{w(t)},500),[]),ae=e.useCallback(C(t=>{T(t)}),[]),re=e.useCallback(C(t=>{E(t)}),[]),se=e.useCallback(()=>{J(t=>!t)},[]),le=e.useCallback(()=>{q(t=>!t)},[]),ne=e.useCallback(t=>{Q((t-1)*j)},[]),oe=e.useCallback((t,{from:r})=>r?Math.abs(t.diff(r,"day"))>31:!1,[]),ce=e.useCallback(()=>{O([]),k([]),w(0),T(0),E(0)},[]),m=e.useRef({}),ie=e.useCallback(t=>(m.current={},t.filter(({total:r,createdAt:l})=>{const o=S.tz(l).format($),g=m.current[o]=m.current[o]??{ordersSum:0,total:0};return g.total+=r,++g.ordersSum,!(d&&d&&r<d)}).filter(({createdAt:r})=>{if(u||h){const l=S.tz(r).format($),o=m.current[l];if(o&&(u&&o.total<u||h&&o.ordersSum<h))return!1}return!0})),[d,u,h]),de=e.useMemo(()=>{var t;return(t=s==null?void 0:s.map)==null?void 0:t.call(s,r=>r.valueOf())},[s]),{periodsOrder:p,orderListElement:ue,anchorElement:he,summaryElement:fe,totalDays:me,callOrderAPI:pe}=Ce({datetime:s!=null&&s.length?de:"today",searchData:v,dateOrder:Z,searchUI:!1,reverse:!1,offset:P,handleRecords:ie});e.useEffect(()=>{const t=i.on(i.KEYBOARD_ON_ACTION,r=>{const{action:l}=r.detail;l==="edit"&&K()});return()=>t()},[i,K]),e.useEffect(()=>{setTimeout(()=>{window.scroll({top:0,left:0,behavior:"smooth"})},200)},[P]),e.useEffect(()=>()=>{window.scroll({top:0,left:0,behavior:"smooth"})},[]);const B=p.length;return n(U,{children:[a(Me,{cls:be,children:n(G,{size:60,children:[a(y,{css:Se,type:"text",icon:a(Ae,{}),onClick:V,children:"訂單搜尋"}),B?n("h2",{children:[B===1?p[0]:[p[0],p.at(-1)??""].join(" ~ "),z&&` (${z})`]}):a("h2",{children:"今天"})]})}),n(c,{css:ye,gap:"middle",vertical:!0,children:[a(Y,{css:H,rootClassName:"resta-orderlist-search-drawer",title:a(U,{children:a(y,{icon:a(_e,{}),type:"text",onClick:ce,children:"重設"})}),getContainer:!1,placement:"left",open:R,mask:!0,onClose:W,children:n(c,{vertical:!0,gap:"large",children:[n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"日期"}),a(Be,{showNow:!0,inputReadOnly:!0,presets:b,showTime:I,format:De,placeholder:["開始日期","結束日期"],size:"large",value:s,disabledDate:oe,onChange:X,renderExtraFooter:()=>a(y,{css:Oe,type:"text",onClick:se,children:I?"關閉時間":"指定時間"})})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"關鍵字"}),a(xe,{placeholder:"找什麼呢?",mode:"tags",size:"large",style:{width:"100%"},allowClear:!0,onKeyUp:t=>{t.preventDefault(),t.stopPropagation()},options:ve,disabled:f,value:v,onChange:ee})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"日期排序"}),a(Ie,{checkedChildren:"反序",unCheckedChildren:"正序",defaultChecked:!0,onChange:le})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"單筆金額大於"}),a(D,{size:"large",type:"number",prefix:"$",style:{width:"60%"},disabled:f,value:d,onChange:te})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"當日營業額大於"}),a(D,{size:"large",type:"number",prefix:"$",style:{width:"60%"},disabled:f,value:u,onChange:ae})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"當日訂單數量大於"}),a(D,{size:"large",type:"number",style:{width:"60%"},disabled:f,value:h,onChange:re})]})]})}),a(Y,{css:[H,ke],title:n(G,{children:[a(Pe,{}),a("label",{children:"編輯訂單"})]}),placement:"right",open:_,mask:!0,onClose:M,width:820,forceRender:!0,children:a(we,{drawerMode:!0,callOrderAPI:pe,submitCallback:M})}),n("div",{css:[Te,(R||_)&&Ee],children:[he,a("div",{css:Re,children:fe}),a(c,{wrap:!0,children:ue}),a(ze,{hideOnSinglePage:!0,total:me,defaultPageSize:j,onChange:ne})]}),a(Fe.BackTop,{visibilityHeight:100})]})]})};export{Ge as Component,Ge as OrderList,Ge as default};
