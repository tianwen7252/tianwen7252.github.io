import{r as e,ak as S,b6 as C,aI as n,aJ as a,be as ge,aK as $,aQ as Ce,aZ as be}from"./vendor-G6F9539m.js";import{S as Se}from"./StickyHeader-DQFqK3uo.js";import{A as ye,O as j,D as U,u as Oe,h as De,s as ve,m as ke,d as G,a as we,t as Te,b as Ee,k as Re,K as Ae,c as Ie,e as _e,l as xe}from"./index-DTXQaDe8.js";import{S as H,B as y,a as c,h as Pe,j as ze,d as O,i as Y,P as Ke,F as Le,k as Fe}from"./antd-YYL4R1sS.js";import"./antd-deps-DFfZDYn9.js";import"./mathjs-DmADWV5u.js";const{RangePicker:Me}=Fe,Be=()=>{const[s,D]=e.useState(),[v,k]=e.useState([]),[d,w]=e.useState(0),[u,T]=e.useState(0),[h,E]=e.useState(0),[R,A]=e.useState(!1),[I,_]=e.useState(!1),[x,Z]=e.useState(!1),[J,Q]=e.useState(!0),[P,q]=e.useState(0),[z,K]=e.useState(""),{appEvent:i}=e.useContext(ye),f=!(s!=null&&s.length),b=e.useMemo(()=>{const t=S.tz(),r=t.startOf("day"),l=t.endOf("day"),o=r.add(-1,"d");return[{label:"今天",value:[r,l]},{label:"昨天",value:[o,o.endOf("day")]},{label:"2天內",value:[o,l]},{label:"7天前",value:[r.add(-7,"d"),l]},{label:"14天內",value:[r.add(-14,"d"),l]},{label:"1個月內",value:[r.add(-30,"d"),l]}]},[]),V=e.useCallback(()=>{A(!0)},[]),W=e.useCallback(()=>{A(!1)},[]),L=e.useCallback(()=>{document.body.classList.add("resta--hidden-scroll"),_(!0)},[]),F=e.useCallback(()=>{document.body.classList.remove("resta--hidden-scroll"),_(!1),i.fire(i.ORDER_AFTER_ACTION)},[i]),X=e.useCallback(t=>{if(t){const[r,l]=t;b.some(({label:g,value:B})=>{const N=B[0].valueOf()===r.valueOf()&&B[1].valueOf()===l.valueOf();return N&&K(g),N})||K(""),D(t)}},[b]),ee=e.useCallback(C(t=>{k(t)},300),[]),te=e.useCallback(C(t=>{w(t)},500),[]),ae=e.useCallback(C(t=>{T(t)}),[]),re=e.useCallback(C(t=>{E(t)}),[]),se=e.useCallback(()=>{Z(t=>!t)},[]),le=e.useCallback(()=>{Q(t=>!t)},[]),ne=e.useCallback(t=>{q((t-1)*j)},[]),oe=e.useCallback((t,{from:r})=>r?Math.abs(t.diff(r,"day"))>31:!1,[]),ce=e.useCallback(()=>{D([]),k([]),w(0),T(0),E(0)},[]),p=e.useRef({}),ie=e.useCallback(t=>(p.current={},t.filter(({total:r,createdAt:l})=>{const o=S.tz(l).format(U),g=p.current[o]=p.current[o]??{ordersSum:0,total:0};return g.total+=r,++g.ordersSum,!(d&&d&&r<d)}).filter(({createdAt:r})=>{if(u||h){const l=S.tz(r).format(U),o=p.current[l];if(o&&(u&&o.total<u||h&&o.ordersSum<h))return!1}return!0})),[d,u,h]),de=e.useMemo(()=>{var t;return(t=s==null?void 0:s.map)==null?void 0:t.call(s,r=>r.valueOf())},[s]),{periodsOrder:m,orderListElement:ue,anchorElement:he,summaryElement:fe,totalDays:pe,callOrderAPI:me}=Oe({datetime:s!=null&&s.length?de:"today",searchData:v,dateOrder:J,searchUI:!1,reverse:!1,offset:P,handleRecords:ie});e.useEffect(()=>{const t=i.on(i.KEYBOARD_ON_ACTION,r=>{const{action:l}=r.detail;l==="edit"&&L()});return()=>t()},[i,L]),e.useEffect(()=>{setTimeout(()=>{window.scroll({top:0,left:0,behavior:"smooth"})},200)},[P]),e.useEffect(()=>()=>{window.scroll({top:0,left:0,behavior:"smooth"})},[]);const M=m.length;return n($,{children:[a(Se,{cls:De,children:n(H,{size:60,children:[a(y,{css:ve,type:"text",icon:a(ge,{}),onClick:V,children:"訂單搜尋"}),M?n("h2",{children:[M===1?m[0]:[m[0],m.at(-1)??""].join(" ~ "),z&&` (${z})`]}):a("h2",{children:"今天"})]})}),n(c,{css:ke,gap:"middle",vertical:!0,children:[a(Y,{css:G,rootClassName:"resta-orderlist-search-drawer",title:a($,{children:a(y,{icon:a(Ce,{}),type:"text",onClick:ce,children:"重設"})}),getContainer:!1,placement:"left",open:R,mask:!0,onClose:W,children:n(c,{vertical:!0,gap:"large",children:[n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"日期"}),a(Me,{showNow:!0,inputReadOnly:!0,presets:b,showTime:x,format:we,placeholder:["開始日期","結束日期"],size:"large",value:s,disabledDate:oe,onChange:X,renderExtraFooter:()=>a(y,{css:Te,type:"text",onClick:se,children:x?"關閉時間":"指定時間"})})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"關鍵字"}),a(Pe,{placeholder:"找什麼呢?",mode:"tags",size:"large",style:{width:"100%"},allowClear:!0,onKeyUp:t=>{t.preventDefault(),t.stopPropagation()},options:Ee,disabled:f,value:v,onChange:ee})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"日期排序"}),a(ze,{checkedChildren:"反序",unCheckedChildren:"正序",defaultChecked:!0,onChange:le})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"單筆金額大於"}),a(O,{size:"large",type:"number",prefix:"$",style:{width:"60%"},disabled:f,value:d,onChange:te})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"當日營業額大於"}),a(O,{size:"large",type:"number",prefix:"$",style:{width:"60%"},disabled:f,value:u,onChange:ae})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"當日訂單數量大於"}),a(O,{size:"large",type:"number",style:{width:"60%"},disabled:f,value:h,onChange:re})]})]})}),a(Y,{css:[G,Re],title:n(H,{children:[a(be,{}),a("label",{children:"編輯訂單"})]}),placement:"right",open:I,mask:!0,onClose:F,width:820,forceRender:!0,children:a(Ae,{drawerMode:!0,callOrderAPI:me,submitCallback:F})}),n("div",{css:[Ie,(R||I)&&_e],children:[he,a("div",{css:xe,children:fe}),a(c,{wrap:!0,children:ue}),a(Ke,{hideOnSinglePage:!0,total:pe,defaultPageSize:j,onChange:ne})]}),a(Le.BackTop,{visibilityHeight:100})]})]})},Ye=Be;export{Be as Component,Ye as OrderList,Ye as default};
