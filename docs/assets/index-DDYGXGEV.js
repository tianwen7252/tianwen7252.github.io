var $e=Object.defineProperty;var Ue=(s,e,t)=>e in s?$e(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var E=(s,e,t)=>Ue(s,typeof e!="symbol"?e+"":e,t);import{g as _,A as xe,r as Q,a as o,j as C,F as Z,L as Pe,M as Ne,x as Be,N as Le}from"./index-B4iP1H4S.js";import{r as h,R as He}from"./react-DQrQyBkK.js";import{S as je}from"./StickyHeader-CCZfhkni.js";import{x as _e,M as Ve,I as G,V as ee,B as A,o as ce,k as Te,F as Fe,m as ze,z as I,W as le,X as de,p as ue,Y as ke,Z as te,$ as D,y as O,a0 as M,S as pe,g as Je,a1 as Ye,a2 as We,a3 as Xe,a4 as Ke,a5 as Qe}from"./antd-DbVoGr1G.js";import{d as oe,c as he,s as Ze,g as Ge}from"./lodash-EY-pETZd.js";import"./mathjs-JIS0MRwP.js";const ne={product:{}},et={storage:ne,updateStorage:()=>{},setInitialStorage:s=>{}},Re=h.createContext(et),tt=_`
  padding: 20px;
`,re=_`
  margin-bottom: 20px;
`,ot=_`
  float: right;
`;_`
  margin-bottom: 16px;
`;_`
  width: 100%;
  margin-bottom: 16px;
`;_`
  width: 100%;
  margin-bottom: 16px;
`;const rt=_`
  margin-bottom: 40px;
  .ant-table-thead > tr > th {
    background: #f1fafe;
  }
`,fe=_`
  margin-top: 20px;
  margin-bottom: 30px;

  .ant-table-thead > tr > th {
    background: #f0f9f3;
  }
`,st=_`
  margin-top: 20px;
  margin-bottom: 20px;

  .ant-table-thead > tr > th {
    background: #fef4cb66;
  }
`,F=_`
  margin-right: 10px;
`,me=_`
  margin-left: 10px;
`,nt=_`
  margin-top: 40px;
  padding: 20px;
`,z=s=>{var t;const e=s.closest(".ant-table-row");return Array.from(((t=e==null?void 0:e.parentElement)==null?void 0:t.childNodes)??[]).indexOf(e)},it=()=>{const{API:s}=h.useContext(xe),{storage:e,updateStorage:t,setInitialStorage:r}=h.useContext(Re),[n,a]=h.useState(""),[u,f]=_e.useNotification(),[b,p]=Ve.useModal(),[R,N]=h.useReducer(d=>!d,!0),$=h.useRef("1");h.useLayoutEffect(()=>{if(n){const[d,m,w]=n.split(":");setTimeout(()=>{var i,c,x,T;const l=document.getElementById(d).querySelectorAll(".ant-table-tbody > tr");if(l.length&&l[w]){const g=l[w];g.childNodes.forEach(y=>{y.classList.remove("ant-table-cell-row-hover")}),m==="up"?(c=(i=g==null?void 0:g.previousSibling)==null?void 0:i.childNodes)==null||c.forEach(y=>{y.classList.add("ant-table-cell-row-hover")}):(T=(x=g==null?void 0:g.nextSibling)==null?void 0:x.childNodes)==null||T.forEach(y=>{y.classList.add("ant-table-cell-row-hover")})}},100)}},[n]);const k=h.useCallback((d=!1)=>{d&&N(),t()},[t]),U=Q(async()=>{const d=await s.commondityTypes.get();return e.product.commondityTypes=d,r("product.commondityTypes"),d.map(m=>({key:m.id,...m}))},[],[]),V=h.useCallback(oe((d,m)=>{e.product.commondityTypes.some(w=>w.id===d?(w.label=m.target.value,k(),!0):!1)},300),[k]),B=h.useMemo(()=>[{title:"編號",dataIndex:"typeID",key:"typeID"},{title:"種類",dataIndex:"label",key:"label",render:(d,m)=>o(G,{defaultValue:m.label,style:{width:200},onChange:V.bind(null,m.id)},m.id)}],[V]),v=Q(async()=>{const d=await s.commondity.get();e.product.commondities=d,r("product.commondities")},[],[]),S=h.useCallback(oe((d,m,w,l)=>{const{commondities:i}=e.product,c=i.find(T=>T.id===d),{typeID:x}=c;if(c){const T=l==null?void 0:l.target,g="resta-settings-commondity-tabs";switch(m){case"edit":{const y=(T==null?void 0:T.value)??l;c[w]=y,k();break}case"delete":{c.id.toString().includes("new-")?e.product.commondities=i.filter(y=>y.id!==d):c.onMarket="0",k(!0);break}case"moveUp":{const y=i.find(q=>q.priority===c.priority-1&&q.typeID===x);if(y){++y.priority,--c.priority;const q=z(T);k(!0),a(`${g}:up:${q}`)}break}case"moveDown":{const y=i.find(q=>q.priority===c.priority+1&&q.typeID===x);if(y){--y.priority,++c.priority;const q=z(T);k(!0),a(`${g}:down:${q}`)}break}}}},150),[]),L=h.useMemo(()=>{var w;const d=[{title:"順序",dataIndex:"priority",key:"priority"},{title:"品名",dataIndex:"name",key:"name",render:(l,i)=>o(G,{defaultValue:i.name,onChange:S.bind(null,i.id,"edit","name")},i.id)},{title:"價格",dataIndex:"price",key:"price",render:(l,i)=>o(ze,{type:"number",defaultValue:i.price,onChange:S.bind(null,i.id,"edit","price")},i.id)},{title:"鍵盤顯示",dataIndex:"hideOnMode",key:"hideOnMode",render:(l,i)=>C(I,{defaultValue:i.hideOnMode||"",style:{width:140},onChange:c=>S(i.id,"edit","hideOnMode",c),children:[o(I.Option,{value:"",children:"皆顯示"}),o(I.Option,{value:"calculator",children:"僅顯示在計算機"}),o(I.Option,{value:"commondity",children:"僅顯示在商品"}),o(I.Option,{value:"both",children:"皆不顯示"})]})},{title:"設定",key:"action",render:(l,i)=>C(Z,{children:[o(A,{css:F,type:"text",variant:"filled",color:"primary",icon:o(le,{}),onClick:S.bind(null,i.id,"moveUp",null)}),o(A,{css:F,type:"text",variant:"filled",color:"primary",icon:o(de,{}),onClick:S.bind(null,i.id,"moveDown",null)}),o(A,{css:me,type:"text",variant:"filled",color:"danger",icon:o(ue,{}),onClick:S.bind(null,i.id,"delete",null)})]})}],m={};return(w=e.product.commondities)==null||w.forEach(l=>{const{id:i,typeID:c,priority:x,onMarket:T}=l;m[c]=m[c]??[],T==="1"&&m[c].push({key:`${i}-${x}`,...l})}),(U==null?void 0:U.map(l=>{const{id:i,label:c,typeID:x}=l,T=m[x]??[];return T.sort((g,y)=>g.priority-y.priority),{key:i,label:c,children:o(ee,{bordered:!1,css:fe,dataSource:T,columns:d,pagination:!1})}}))??[]},[U,S,v,R]),H=h.useCallback(()=>{var l,i;const d=$.current,{commondities:m}=e.product,w=m.filter(c=>c.typeID===d).sort((c,x)=>c.priority-x.priority);if(w){const c=w.at(-1).priority+1;m.push({hideOnMode:"",id:`new-${Date.now()}`,name:"",onMarket:"1",price:0,priority:c,editor:"admin",typeID:d}),k(!0),window.scroll({top:((i=(l=document.getElementById("resta-settings-commondity-tabs"))==null?void 0:l.getBoundingClientRect())==null?void 0:i.bottom)-document.body.getBoundingClientRect().top-150,left:0,behavior:"smooth"})}},[e.product,k]),X=Q(async()=>{const d=await s.orderTypes.get();e.product.orderTypes=d,r("product.orderTypes")},[],[]),P=h.useCallback(oe((d,m,w,l)=>{const{orderTypes:i}=e.product,c=i.find(x=>x.id===d);if(c){const x=l==null?void 0:l.target,T="resta-settings-orderTypes-table";switch(m){case"edit":{const g=(x==null?void 0:x.value)??l;c[w]=g,k();break}case"delete":{e.product.orderTypes=i.filter(g=>g.id!==d),k(!0);break}case"moveUp":{const g=i.find(y=>y.priority===c.priority-1);if(g){++g.priority,--c.priority;const y=z(x);k(!0),a(`${T}:up:${y}`)}break}case"moveDown":{const g=i.find(y=>y.priority===c.priority+1);if(g){--g.priority,++c.priority;const y=z(x);k(!0),a(`${T}:down:${y}`)}break}}}},150),[]),[K,De]=h.useMemo(()=>{var w;const d=[{title:"順序",dataIndex:"priority",key:"priority"},{title:"名稱",dataIndex:"name",key:"name",render:(l,i)=>o(G,{defaultValue:i.name,onChange:P.bind(null,i.id,"edit","name")},i.id)},{title:"顏色",dataIndex:"color",key:"color",render:(l,i)=>C(I,{defaultValue:i.color??"",style:{width:120},onChange:c=>P(i.id,"edit","color",c),children:[o(I.Option,{value:"",children:"無"}),o(I.Option,{value:"red",children:"紅色"}),o(I.Option,{value:"blue",children:"藍色"}),o(I.Option,{value:"purple",children:"紫色"}),o(I.Option,{value:"gold",children:"金色"}),o(I.Option,{value:"brown",children:"咖啡色"})]},i.id)},{title:"設定",key:"action",render:(l,i)=>C(Z,{children:[o(A,{css:F,type:"text",variant:"filled",color:"primary",icon:o(le,{}),onClick:P.bind(null,i.id,"moveUp",null)}),o(A,{css:F,type:"text",variant:"filled",color:"primary",icon:o(de,{}),onClick:P.bind(null,i.id,"moveDown",null)}),o(A,{css:me,type:"text",variant:"filled",color:"danger",icon:o(ue,{}),onClick:P.bind(null,i.id,"delete",null)})]})}],m=((w=e.product.orderTypes)==null?void 0:w.map(l=>({...l,key:l.id})).sort((l,i)=>l.priority-i.priority))??[];return[d,m]},[X,P,R]),Oe=h.useCallback(()=>{var w,l;const{orderTypes:d}=e.product;if(d.length>=10){u.warning({message:"系統設定",description:"訂單分類最多只能10個",showProgress:!0});return}const m=d.sort((i,c)=>i.priority-c.priority);if(m){const i=m.at(-1).priority+1;d.push({id:`new-${Date.now()}`,name:"",priority:i,editor:"admin",type:"order"}),k(!0),window.scroll({top:((l=(w=document.getElementById("resta-settings-orderTypes-table"))==null?void 0:w.getBoundingClientRect())==null?void 0:l.bottom)-document.body.getBoundingClientRect().top-100,left:0,behavior:"smooth"})}},[e.product,u,k]),Me=h.useCallback(d=>{$.current=d},[]);return C("div",{css:tt,children:[f,p,o("h2",{css:re,children:"商品種類"}),o(ee,{bordered:!1,css:rt,dataSource:U,columns:B,pagination:!1}),o("h2",{css:re,children:"商品設定"}),o(Te,{id:"resta-settings-commondity-tabs",items:L,css:fe,tabBarExtraContent:o(A,{icon:o(ce,{}),onClick:H,children:"新增商品"}),onChange:Me}),C("h2",{css:re,children:["訂單分類",o(A,{css:ot,icon:o(ce,{}),onClick:Oe,children:"新增分類"})]}),o(ee,{id:"resta-settings-orderTypes-table",css:st,bordered:!1,dataSource:De,columns:K,pagination:!1}),o(A,{css:nt,type:"primary",danger:!0,block:!0,onClick:h.useCallback(()=>{b.confirm({title:"危險動作 - 請再次確認",content:C(Z,{children:[o("label",{children:"確定要還原所有商品和分類到預設狀態嗎？此操作無法復原。"}),C("h4",{children:["預設資料的最後更新日期為：",Pe]})]}),okText:"確認還原",cancelText:"取消",okType:"danger",width:500,onOk:()=>{s.reset(),setTimeout(()=>{u.success({message:"系統設定",description:"資料已還原成功，即將重新啟動App...",showProgress:!0,duration:3})},100),setTimeout(()=>{window.location.reload()},3e3)}})},[b,s,u]),children:"還原預設"}),o(Fe.BackTop,{visibilityHeight:100})]})};class ye extends Error{constructor(t,r,n){const a=t.status||t.status===0?t.status:"",u=t.statusText||"",f=`${a} ${u}`.trim(),b=f?`status code ${f}`:"an unknown error";super(`Request failed with ${b}: ${r.method} ${r.url}`);E(this,"response");E(this,"request");E(this,"options");this.name="HTTPError",this.response=t,this.request=r,this.options=n}}class Ce extends Error{constructor(t){super(`Request timed out: ${t.method} ${t.url}`);E(this,"request");this.name="TimeoutError",this.request=t}}const j=s=>s!==null&&typeof s=="object",J=(...s)=>{for(const e of s)if((!j(e)||Array.isArray(e))&&e!==void 0)throw new TypeError("The `options` argument must be an object");return ae({},...s)},Ie=(s={},e={})=>{const t=new globalThis.Headers(s),r=e instanceof globalThis.Headers,n=new globalThis.Headers(e);for(const[a,u]of n.entries())r&&u==="undefined"||u===void 0?t.delete(a):t.set(a,u);return t};function Y(s,e,t){return Object.hasOwn(e,t)&&e[t]===void 0?[]:ae(s[t]??[],e[t]??[])}const ve=(s={},e={})=>({beforeRequest:Y(s,e,"beforeRequest"),beforeRetry:Y(s,e,"beforeRetry"),afterResponse:Y(s,e,"afterResponse"),beforeError:Y(s,e,"beforeError")}),ae=(...s)=>{let e={},t={},r={};for(const n of s)if(Array.isArray(n))Array.isArray(e)||(e=[]),e=[...e,...n];else if(j(n)){for(let[a,u]of Object.entries(n))j(u)&&a in e&&(u=ae(e[a],u)),e={...e,[a]:u};j(n.hooks)&&(r=ve(r,n.hooks),e.hooks=r),j(n.headers)&&(t=Ie(t,n.headers),e.headers=t)}return e},at=(()=>{let s=!1,e=!1;const t=typeof globalThis.ReadableStream=="function",r=typeof globalThis.Request=="function";if(t&&r)try{e=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type")}catch(n){if(n instanceof Error&&n.message==="unsupported BodyInit type")return!1;throw n}return s&&!e})(),ct=typeof globalThis.AbortController=="function",lt=typeof globalThis.ReadableStream=="function",dt=typeof globalThis.FormData=="function",Se=["get","post","put","patch","head","delete"],ut={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},se=2147483647,Ee=Symbol("stop"),pt={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,fetch:!0},ht={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,dispatcher:!0,duplex:!0,priority:!0},ft=s=>Se.includes(s)?s.toUpperCase():s,mt=["get","put","head","delete","options","trace"],yt=[408,413,429,500,502,503,504],bt=[413,429,503],be={limit:2,methods:mt,statusCodes:yt,afterStatusCodes:bt,maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:s=>.3*2**(s-1)*1e3},gt=(s={})=>{if(typeof s=="number")return{...be,limit:s};if(s.methods&&!Array.isArray(s.methods))throw new Error("retry.methods must be an array");if(s.statusCodes&&!Array.isArray(s.statusCodes))throw new Error("retry.statusCodes must be an array");return{...be,...s}};async function wt(s,e,t,r){return new Promise((n,a)=>{const u=setTimeout(()=>{t&&t.abort(),a(new Ce(s))},r.timeout);r.fetch(s,e).then(n).catch(a).then(()=>{clearTimeout(u)})})}async function xt(s,{signal:e}){return new Promise((t,r)=>{e&&(e.throwIfAborted(),e.addEventListener("abort",n,{once:!0}));function n(){clearTimeout(a),r(e.reason)}const a=setTimeout(()=>{e==null||e.removeEventListener("abort",n),t()},s)})}const _t=(s,e)=>{const t={};for(const r in e)!(r in ht)&&!(r in pt)&&!(r in s)&&(t[r]=e[r]);return t};class W{constructor(e,t={}){E(this,"request");E(this,"abortController");E(this,"_retryCount",0);E(this,"_input");E(this,"_options");var r,n;if(this._input=e,this._options={...t,headers:Ie(this._input.headers,t.headers),hooks:ve({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},t.hooks),method:ft(t.method??this._input.method),prefixUrl:String(t.prefixUrl||""),retry:gt(t.retry),throwHttpErrors:t.throwHttpErrors!==!1,timeout:t.timeout??1e4,fetch:t.fetch??globalThis.fetch.bind(globalThis)},typeof this._input!="string"&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&typeof this._input=="string"){if(this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(ct){this.abortController=new globalThis.AbortController;const a=this._options.signal??this._input.signal;a!=null&&a.aborted&&this.abortController.abort(a==null?void 0:a.reason),a==null||a.addEventListener("abort",()=>{this.abortController.abort(a.reason)}),this._options.signal=this.abortController.signal}if(at&&(this._options.duplex="half"),this._options.json!==void 0&&(this._options.body=((n=(r=this._options).stringifyJson)==null?void 0:n.call(r,this._options.json))??JSON.stringify(this._options.json),this._options.headers.set("content-type",this._options.headers.get("content-type")??"application/json")),this.request=new globalThis.Request(this._input,this._options),this._options.searchParams){const u="?"+(typeof this._options.searchParams=="string"?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString()),f=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,u);(dt&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)&&!(this._options.headers&&this._options.headers["content-type"])&&this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(f,{...this.request}),this._options)}}static create(e,t){const r=new W(e,t),n=async()=>{if(typeof r._options.timeout=="number"&&r._options.timeout>se)throw new RangeError(`The \`timeout\` option cannot be greater than ${se}`);await Promise.resolve();let f=await r._fetch();for(const b of r._options.hooks.afterResponse){const p=await b(r.request,r._options,r._decorateResponse(f.clone()));p instanceof globalThis.Response&&(f=p)}if(r._decorateResponse(f),!f.ok&&r._options.throwHttpErrors){let b=new ye(f,r.request,r._options);for(const p of r._options.hooks.beforeError)b=await p(b);throw b}if(r._options.onDownloadProgress){if(typeof r._options.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!lt)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return r._stream(f.clone(),r._options.onDownloadProgress)}return f},u=r._options.retry.methods.includes(r.request.method.toLowerCase())?r._retry(n):n();for(const[f,b]of Object.entries(ut))u[f]=async()=>{r.request.headers.set("accept",r.request.headers.get("accept")||b);const p=await u;if(f==="json"){if(p.status===204||(await p.clone().arrayBuffer()).byteLength===0)return"";if(t.parseJson)return t.parseJson(await p.text())}return p[f]()};return u}_calculateRetryDelay(e){if(this._retryCount++,this._retryCount>this._options.retry.limit||e instanceof Ce)throw e;if(e instanceof ye){if(!this._options.retry.statusCodes.includes(e.response.status))throw e;const r=e.response.headers.get("Retry-After")??e.response.headers.get("RateLimit-Reset")??e.response.headers.get("X-RateLimit-Reset")??e.response.headers.get("X-Rate-Limit-Reset");if(r&&this._options.retry.afterStatusCodes.includes(e.response.status)){let n=Number(r)*1e3;Number.isNaN(n)?n=Date.parse(r)-Date.now():n>=Date.parse("2024-01-01")&&(n-=Date.now());const a=this._options.retry.maxRetryAfter??n;return n<a?n:a}if(e.response.status===413)throw e}const t=this._options.retry.delay(this._retryCount);return Math.min(this._options.retry.backoffLimit,t)}_decorateResponse(e){return this._options.parseJson&&(e.json=async()=>this._options.parseJson(await e.text())),e}async _retry(e){try{return await e()}catch(t){const r=Math.min(this._calculateRetryDelay(t),se);if(this._retryCount<1)throw t;await xt(r,{signal:this._options.signal});for(const n of this._options.hooks.beforeRetry)if(await n({request:this.request,options:this._options,error:t,retryCount:this._retryCount})===Ee)return;return this._retry(e)}}async _fetch(){for(const r of this._options.hooks.beforeRequest){const n=await r(this.request,this._options);if(n instanceof Request){this.request=n;break}if(n instanceof Response)return n}const e=_t(this.request,this._options),t=this.request;return this.request=t.clone(),this._options.timeout===!1?this._options.fetch(t,e):wt(t,e,this.abortController,this._options)}_stream(e,t){const r=Number(e.headers.get("content-length"))||0;let n=0;return e.status===204?(t&&t({percent:1,totalBytes:r,transferredBytes:n},new Uint8Array),new globalThis.Response(null,{status:e.status,statusText:e.statusText,headers:e.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(a){const u=e.body.getReader();t&&t({percent:0,transferredBytes:0,totalBytes:r},new Uint8Array);async function f(){const{done:b,value:p}=await u.read();if(b){a.close();return}if(t){n+=p.byteLength;const R=r===0?0:n/r;t({percent:R,transferredBytes:n,totalBytes:r},p)}a.enqueue(p),await f()}await f()}}),{status:e.status,statusText:e.statusText,headers:e.headers})}}/*! MIT License © Sindre Sorhus */const ie=s=>{const e=(t,r)=>W.create(t,J(s,r));for(const t of Se)e[t]=(r,n)=>W.create(r,J(s,n,{method:t}));return e.create=t=>ie(J(t)),e.extend=t=>(typeof t=="function"&&(t=t(s??{})),ie(J(s,t))),e.stop=Ee,e},Tt=ie();var Ae={exports:{}},kt=h;function qe(s,e,t){var r=typeof e=="function";kt.useEffect(function(){var n,a=!0,u=s(function(){return a});return Promise.resolve(u).then(function(f){n=f}),function(){a=!1,r&&e(n)}},r?t:e)}Ae.exports=qe;var Rt=Ae.exports.useAsyncEffect=qe;const ge="0.0.22",Ct=_`
  .ant-card-bordered {
    border: 1px solid #ddd;
    background-image: linear-gradient(
      to right bottom,
      #ffffff,
      #fff,
      #fff,
      #fff,
      #f5f5f5
    );
  }
  .ant-statistic .ant-statistic-title {
    font-size: 0.9rem;
    color: #777;
  }
`,we=s=>Number(s==null?void 0:s.replaceAll(".","")),It=He.memo(()=>{const[s,e]=_e.useNotification(),[t,r]=h.useState("---"),[{useage:n,percentageUsed:a,remaining:u},f]=h.useState({useage:"---",percentageUsed:"---",remaining:"---"});let b=!1;return we(t)>we(ge)&&(b=!0),Rt(async()=>{try{const p=await Tt.get(Ne).json();if(p!=null&&p.start_url){const R=p.start_url.match(/v=(.+)/);R&&r(R[1])}}catch(p){p!=null&&p.message&&s.error({message:"網路資料錯誤",description:`取得最新版本失敗: ${p.message}`,duration:20,showProgress:!0})}try{const{useage:p,percentageUsed:R,remaining:N}=await Be();f({useage:p,percentageUsed:R,remaining:N})}catch{}},[s]),C("div",{css:Ct,children:[e,b&&o(ke,{style:{margin:"12px 0"},message:"請重開App將自動更新到最新版本",type:"warning",showIcon:!0}),C(te,{gutter:12,children:[o(M,{span:8,children:o(D,{children:o(O,{title:"本機App版本",prefix:"v",value:ge})})}),o(M,{span:8,children:o(D,{children:o(O,{title:"程式資料庫同步版本",value:Le})})}),o(M,{span:8,children:o(D,{children:o(O,{title:"本機資料庫同步版本",value:localStorage.getItem("SYNC_NUMBER")})})})]}),C(te,{gutter:12,style:{marginTop:12},children:[o(M,{span:8,children:o(D,{children:o(O,{title:"最新App版本",prefix:"v",value:t})})}),o(M,{span:8,children:o(D,{children:o(O,{title:"雲端資料同步版本",value:"---"})})}),o(M,{span:8,children:o(D,{children:o(O,{title:"本機雲端資料同步版本",value:localStorage.getItem("CLOUD_SYNC_NUMBER")??"---"})})})]}),C(te,{gutter:12,style:{marginTop:12},children:[o(M,{span:8,children:o(D,{children:o(O,{title:"本機資料庫使用量",value:n})})}),o(M,{span:8,children:o(D,{children:o(O,{title:"本機資料庫剩餘量",value:u})})}),o(M,{span:8,children:o(D,{children:o(O,{title:"本機資料庫使用率",value:a})})})]})]})}),vt=_`
  margin-bottom: 20px;
  font-size: 1.4rem;
  color: #6b6868;
  padding: 10px 20px;
`,St=_`
  vertical-align: middle;
`,Et=_`
  padding-bottom: 80px;
  h2 {
    font-weight: normal;
    color: #6b6868;
    font-size: 1.3rem;
    border-left: 6px solid #6b686891;
    border-radius: 4px;
    padding-left: 8px;
  }
  .ant-tabs .ant-tabs-tab {
    font-size: 1rem;
  }
`,At=_`
  padding: 0 20px;
`,qt=_`
  padding: 4px 8px;
  margin-left: 20px;
`,Dt=_`
  float: right;
  right: 60px;
  padding: 14px 8px;
  top: 5px;
  font-size: 1rem;
`,Ot=[{key:"info",icon:o(Ye,{}),label:"系統資訊",children:o(It,{})},{key:"product",icon:o(We,{}),label:"商品設定",children:o(it,{})},{key:"stuff",icon:o(Xe,{}),label:"員工設定"},{key:"cost",icon:o(Ke,{}),label:"每月成本"},{key:"cloud",icon:o(Qe,{}),label:"雲端同步"}],Ht=()=>{const{API:s}=h.useContext(xe),e=h.useMemo(()=>({...ne}),[]),t=h.useMemo(()=>he(ne),[]),[r,n]=h.useState(!1),a=h.useCallback(()=>{console.log("comparison",e,t),n(JSON.stringify(e)!==JSON.stringify(t))},[e,t]),u=h.useCallback(()=>{let b=!1;const{product:{commondityTypes:p,commondities:R,orderTypes:N}}=e;p.forEach((v,S)=>{t.product.commondityTypes[S].label!==v.label&&(s.commondityTypes.set(v.id,v),b=!0)});const $=t.product.commondities,k=R.length>=$.length?"new":R.length<$.length?"deleted":"same",[U,V]=k==="new"?[R,$]:[$,R],B=new Set($.map(v=>v.id.toString()));console.log("source & iDMap",U,Array.from(B)),U.forEach((v,S)=>{const L=V[S],H=L.id.toString();if(!H.includes("new-")){if(B.has(H)){B.delete(H);const{name:X,price:P,priority:K}=L;X!==v.name||P!==v.price||v.priority}}}),b&&n(!1)},[e,t,a,s]),f=h.useMemo(()=>({storage:e,updateStorage:a,setInitialStorage:b=>{Ze(t,b,he(Ge(e,b))),console.log("init",b,e,t)}}),[e,t,a]);return o(Re.Provider,{value:f,children:C("div",{css:Et,children:[C(je,{cls:vt,children:[C(pe,{css:St,children:[o(Je,{}),o("label",{children:"系統設定"}),r&&o(pe,{children:o(ke,{css:qt,description:"設定尚未存檔",type:"warning",showIcon:!0})})]}),r&&o(A,{css:Dt,size:"small",type:"primary",onClick:u,children:"存檔設定 (未完成)"})]}),o("div",{css:At,children:o(Te,{items:Ot,defaultActiveKey:"info",destroyInactiveTabPane:!0})})]})})};export{Ht as Component,Ht as Settings,Ht as default};
