import{Q as Ze,C as ae,g as I,A as we,j as S,a as y,i as De,n as pe,o as Oe,p as et,q as tt,D as me,r as at,v as rt,w as nt,b as st,F as ot}from"./index-BMXlYxi-.js";import{r as b,R as Te,e as Ae,g as Se}from"./react-DQrQyBkK.js";import{b as _,L as it,N as lt,i as U,S as $e,t as ge,E as ut,f as Re,O as dt,Q as ct,U as ft,y as Y,F as ht,K as vt}from"./antd-DbVoGr1G.js";import{S as yt}from"./StickyHeader-CUVbBqsJ.js";import{C as W,L as bt,B as pt,D as mt,a as gt,P as xt,m as J,t as Ct,r as k,d as _t,b as kt,v as Mt,c as Pe,i as K,A as Et,e as wt,f as Dt,g as Ot,h as Tt,j as At,k as St}from"./chartjs-BfNRQnNB.js";import{u as $t,a as Rt,b as Pt,i as F}from"./lodash-EY-pETZd.js";import"./mathjs-JIS0MRwP.js";const Ie="label";function xe(e,r){typeof e=="function"?e(r):e&&(e.current=r)}function It(e,r){const a=e.options;a&&r&&Object.assign(a,r)}function Ye(e,r){e.labels=r}function Fe(e,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ie;const t=[];e.datasets=r.map(n=>{const s=e.datasets.find(o=>o[a]===n[a]);return!s||!n.data||t.includes(s)?{...n}:(t.push(s),Object.assign(s,n),s)})}function Yt(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ie;const a={labels:[],datasets:[]};return Ye(a,e.labels),Fe(a,e.datasets,r),a}function Ft(e,r){const{height:a=150,width:t=300,redraw:n=!1,datasetIdKey:s,type:o,data:i,options:l,plugins:u=[],fallbackContent:d,updateMode:c,...f}=e,v=b.useRef(null),h=b.useRef(),g=()=>{v.current&&(h.current=new W(v.current,{type:o,data:Yt(i,s),options:l&&{...l},plugins:u}),xe(r,h.current))},m=()=>{xe(r,null),h.current&&(h.current.destroy(),h.current=null)};return b.useEffect(()=>{!n&&h.current&&l&&It(h.current,l)},[n,l]),b.useEffect(()=>{!n&&h.current&&Ye(h.current.config.data,i.labels)},[n,i.labels]),b.useEffect(()=>{!n&&h.current&&i.datasets&&Fe(h.current.config.data,i.datasets,s)},[n,i.datasets]),b.useEffect(()=>{h.current&&(n?(m(),setTimeout(g)):h.current.update(c))},[n,l,i.labels,i.datasets,c]),b.useEffect(()=>{h.current&&(m(),setTimeout(g))},[o]),b.useEffect(()=>(g(),()=>m()),[]),Te.createElement("canvas",Object.assign({ref:v,role:"img",height:a,width:t},f),d)}const Bt=b.forwardRef(Ft);function Z(e,r){return W.register(r),b.forwardRef((a,t)=>Te.createElement(Bt,Object.assign({},a,{ref:t,type:e})))}const Lt=Z("line",bt),Wt=Z("bar",pt),jt=Z("doughnut",mt),zt=Z("bubble",gt),Nt=Z("pie",xt);/*!
 * chartjs-plugin-datalabels v2.2.0
 * https://chartjs-plugin-datalabels.netlify.app
 * (c) 2017-2022 chartjs-plugin-datalabels contributors
 * Released under the MIT license
 */var Ce=function(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var e=window.screen;if(e)return(e.deviceXDPI||1)/(e.logicalXDPI||1)}return 1}(),V={toTextLines:function(e){var r=[],a;for(e=[].concat(e);e.length;)a=e.pop(),typeof a=="string"?r.unshift.apply(r,a.split(`
`)):Array.isArray(a)?e.push.apply(e,a):K(e)||r.unshift(""+a);return r},textSize:function(e,r,a){var t=[].concat(r),n=t.length,s=e.font,o=0,i;for(e.font=a.string,i=0;i<n;++i)o=Math.max(e.measureText(t[i]).width,o);return e.font=s,{height:n*a.lineHeight,width:o}},bound:function(e,r,a){return Math.max(e,Math.min(r,a))},arrayDiff:function(e,r){var a=e.slice(),t=[],n,s,o,i;for(n=0,o=r.length;n<o;++n)i=r[n],s=a.indexOf(i),s===-1?t.push([i,1]):a.splice(s,1);for(n=0,o=a.length;n<o;++n)t.push([a[n],-1]);return t},rasterize:function(e){return Math.round(e*Ce)/Ce}};function ue(e,r){var a=r.x,t=r.y;if(a===null)return{x:0,y:-1};if(t===null)return{x:1,y:0};var n=e.x-a,s=e.y-t,o=Math.sqrt(n*n+s*s);return{x:o?n/o:0,y:o?s/o:-1}}function Ht(e,r,a,t,n){switch(n){case"center":a=t=0;break;case"bottom":a=0,t=1;break;case"right":a=1,t=0;break;case"left":a=-1,t=0;break;case"top":a=0,t=-1;break;case"start":a=-a,t=-t;break;case"end":break;default:n*=Math.PI/180,a=Math.cos(n),t=Math.sin(n);break}return{x:e,y:r,vx:a,vy:t}}var qt=0,Be=1,Le=2,We=4,je=8;function re(e,r,a){var t=qt;return e<a.left?t|=Be:e>a.right&&(t|=Le),r<a.top?t|=je:r>a.bottom&&(t|=We),t}function Gt(e,r){for(var a=e.x0,t=e.y0,n=e.x1,s=e.y1,o=re(a,t,r),i=re(n,s,r),l,u,d;!(!(o|i)||o&i);)l=o||i,l&je?(u=a+(n-a)*(r.top-t)/(s-t),d=r.top):l&We?(u=a+(n-a)*(r.bottom-t)/(s-t),d=r.bottom):l&Le?(d=t+(s-t)*(r.right-a)/(n-a),u=r.right):l&Be&&(d=t+(s-t)*(r.left-a)/(n-a),u=r.left),l===o?(a=u,t=d,o=re(a,t,r)):(n=u,s=d,i=re(n,s,r));return{x0:a,x1:n,y0:t,y1:s}}function ne(e,r){var a=r.anchor,t=e,n,s;return r.clamp&&(t=Gt(t,r.area)),a==="start"?(n=t.x0,s=t.y0):a==="end"?(n=t.x1,s=t.y1):(n=(t.x0+t.x1)/2,s=(t.y0+t.y1)/2),Ht(n,s,e.vx,e.vy,r.align)}var se={arc:function(e,r){var a=(e.startAngle+e.endAngle)/2,t=Math.cos(a),n=Math.sin(a),s=e.innerRadius,o=e.outerRadius;return ne({x0:e.x+t*s,y0:e.y+n*s,x1:e.x+t*o,y1:e.y+n*o,vx:t,vy:n},r)},point:function(e,r){var a=ue(e,r.origin),t=a.x*e.options.radius,n=a.y*e.options.radius;return ne({x0:e.x-t,y0:e.y-n,x1:e.x+t,y1:e.y+n,vx:a.x,vy:a.y},r)},bar:function(e,r){var a=ue(e,r.origin),t=e.x,n=e.y,s=0,o=0;return e.horizontal?(t=Math.min(e.x,e.base),s=Math.abs(e.base-e.x)):(n=Math.min(e.y,e.base),o=Math.abs(e.base-e.y)),ne({x0:t,y0:n+o,x1:t+s,y1:n,vx:a.x,vy:a.y},r)},fallback:function(e,r){var a=ue(e,r.origin);return ne({x0:e.x,y0:e.y,x1:e.x+(e.width||0),y1:e.y+(e.height||0),vx:a.x,vy:a.y},r)}},P=V.rasterize;function Qt(e){var r=e.borderWidth||0,a=e.padding,t=e.size.height,n=e.size.width,s=-n/2,o=-t/2;return{frame:{x:s-a.left-r,y:o-a.top-r,w:n+a.width+r*2,h:t+a.height+r*2},text:{x:s,y:o,w:n,h:t}}}function Ut(e,r){var a=r.chart.getDatasetMeta(r.datasetIndex).vScale;if(!a)return null;if(a.xCenter!==void 0&&a.yCenter!==void 0)return{x:a.xCenter,y:a.yCenter};var t=a.getBasePixel();return e.horizontal?{x:t,y:null}:{x:null,y:t}}function Kt(e){return e instanceof Et?se.arc:e instanceof wt?se.point:e instanceof Dt?se.bar:se.fallback}function Vt(e,r,a,t,n,s){var o=Math.PI/2;if(s){var i=Math.min(s,n/2,t/2),l=r+i,u=a+i,d=r+t-i,c=a+n-i;e.moveTo(r,u),l<d&&u<c?(e.arc(l,u,i,-Math.PI,-o),e.arc(d,u,i,-o,0),e.arc(d,c,i,0,o),e.arc(l,c,i,o,Math.PI)):l<d?(e.moveTo(l,a),e.arc(d,u,i,-o,o),e.arc(l,u,i,o,Math.PI+o)):u<c?(e.arc(l,u,i,-Math.PI,0),e.arc(l,c,i,0,Math.PI)):e.arc(l,u,i,-Math.PI,Math.PI),e.closePath(),e.moveTo(r,a)}else e.rect(r,a,t,n)}function Xt(e,r,a){var t=a.backgroundColor,n=a.borderColor,s=a.borderWidth;!t&&(!n||!s)||(e.beginPath(),Vt(e,P(r.x)+s/2,P(r.y)+s/2,P(r.w)-s,P(r.h)-s,a.borderRadius),e.closePath(),t&&(e.fillStyle=t,e.fill()),n&&s&&(e.strokeStyle=n,e.lineWidth=s,e.lineJoin="miter",e.stroke()))}function Jt(e,r,a){var t=a.lineHeight,n=e.w,s=e.x,o=e.y+t/2;return r==="center"?s+=n/2:(r==="end"||r==="right")&&(s+=n),{h:t,w:n,x:s,y:o}}function Zt(e,r,a){var t=e.shadowBlur,n=a.stroked,s=P(a.x),o=P(a.y),i=P(a.w);n&&e.strokeText(r,s,o,i),a.filled&&(t&&n&&(e.shadowBlur=0),e.fillText(r,s,o,i),t&&n&&(e.shadowBlur=t))}function ea(e,r,a,t){var n=t.textAlign,s=t.color,o=!!s,i=t.font,l=r.length,u=t.textStrokeColor,d=t.textStrokeWidth,c=u&&d,f;if(!(!l||!o&&!c))for(a=Jt(a,n,i),e.font=i.string,e.textAlign=n,e.textBaseline="middle",e.shadowBlur=t.textShadowBlur,e.shadowColor=t.textShadowColor,o&&(e.fillStyle=s),c&&(e.lineJoin="round",e.lineWidth=d,e.strokeStyle=u),f=0,l=r.length;f<l;++f)Zt(e,r[f],{stroked:c,filled:o,w:a.w,x:a.x,y:a.y+a.h*f})}var ze=function(e,r,a,t){var n=this;n._config=e,n._index=t,n._model=null,n._rects=null,n._ctx=r,n._el=a};J(ze.prototype,{_modelize:function(e,r,a,t){var n=this,s=n._index,o=Ct(k([a.font,{}],t,s)),i=k([a.color,_t.color],t,s);return{align:k([a.align,"center"],t,s),anchor:k([a.anchor,"center"],t,s),area:t.chart.chartArea,backgroundColor:k([a.backgroundColor,null],t,s),borderColor:k([a.borderColor,null],t,s),borderRadius:k([a.borderRadius,0],t,s),borderWidth:k([a.borderWidth,0],t,s),clamp:k([a.clamp,!1],t,s),clip:k([a.clip,!1],t,s),color:i,display:e,font:o,lines:r,offset:k([a.offset,4],t,s),opacity:k([a.opacity,1],t,s),origin:Ut(n._el,t),padding:kt(k([a.padding,4],t,s)),positioner:Kt(n._el),rotation:k([a.rotation,0],t,s)*(Math.PI/180),size:V.textSize(n._ctx,r,o),textAlign:k([a.textAlign,"start"],t,s),textShadowBlur:k([a.textShadowBlur,0],t,s),textShadowColor:k([a.textShadowColor,i],t,s),textStrokeColor:k([a.textStrokeColor,i],t,s),textStrokeWidth:k([a.textStrokeWidth,0],t,s)}},update:function(e){var r=this,a=null,t=null,n=r._index,s=r._config,o,i,l,u=k([s.display,!0],e,n);u&&(o=e.dataset.data[n],i=Mt(Pe(s.formatter,[o,e]),o),l=K(i)?[]:V.toTextLines(i),l.length&&(a=r._modelize(u,l,s,e),t=Qt(a))),r._model=a,r._rects=t},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(e,r){var a=this,t=e.ctx,n=a._model,s=a._rects,o;this.visible()&&(t.save(),n.clip&&(o=n.area,t.beginPath(),t.rect(o.left,o.top,o.right-o.left,o.bottom-o.top),t.clip()),t.globalAlpha=V.bound(0,n.opacity,1),t.translate(P(r.x),P(r.y)),t.rotate(n.rotation),Xt(t,s.frame,n),ea(t,n.lines,s.text,n),t.restore())}});var ta=Number.MIN_SAFE_INTEGER||-9007199254740991,aa=Number.MAX_SAFE_INTEGER||9007199254740991;function G(e,r,a){var t=Math.cos(a),n=Math.sin(a),s=r.x,o=r.y;return{x:s+t*(e.x-s)-n*(e.y-o),y:o+n*(e.x-s)+t*(e.y-o)}}function _e(e,r){var a=aa,t=ta,n=r.origin,s,o,i,l,u;for(s=0;s<e.length;++s)o=e[s],i=o.x-n.x,l=o.y-n.y,u=r.vx*i+r.vy*l,a=Math.min(a,u),t=Math.max(t,u);return{min:a,max:t}}function oe(e,r){var a=r.x-e.x,t=r.y-e.y,n=Math.sqrt(a*a+t*t);return{vx:(r.x-e.x)/n,vy:(r.y-e.y)/n,origin:e,ln:n}}var Ne=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};J(Ne.prototype,{center:function(){var e=this._rect;return{x:e.x+e.w/2,y:e.y+e.h/2}},update:function(e,r,a){this._rotation=a,this._rect={x:r.x+e.x,y:r.y+e.y,w:r.w,h:r.h}},contains:function(e){var r=this,a=1,t=r._rect;return e=G(e,r.center(),-r._rotation),!(e.x<t.x-a||e.y<t.y-a||e.x>t.x+t.w+a*2||e.y>t.y+t.h+a*2)},intersects:function(e){var r=this._points(),a=e._points(),t=[oe(r[0],r[1]),oe(r[0],r[3])],n,s,o;for(this._rotation!==e._rotation&&t.push(oe(a[0],a[1]),oe(a[0],a[3])),n=0;n<t.length;++n)if(s=_e(r,t[n]),o=_e(a,t[n]),s.max<o.min||o.max<s.min)return!1;return!0},_points:function(){var e=this,r=e._rect,a=e._rotation,t=e.center();return[G({x:r.x,y:r.y},t,a),G({x:r.x+r.w,y:r.y},t,a),G({x:r.x+r.w,y:r.y+r.h},t,a),G({x:r.x,y:r.y+r.h},t,a)]}});function He(e,r,a){var t=r.positioner(e,r),n=t.vx,s=t.vy;if(!n&&!s)return{x:t.x,y:t.y};var o=a.w,i=a.h,l=r.rotation,u=Math.abs(o/2*Math.cos(l))+Math.abs(i/2*Math.sin(l)),d=Math.abs(o/2*Math.sin(l))+Math.abs(i/2*Math.cos(l)),c=1/Math.max(Math.abs(n),Math.abs(s));return u*=n*c,d*=s*c,u+=r.offset*n,d+=r.offset*s,{x:t.x+u,y:t.y+d}}function ra(e,r){var a,t,n,s;for(a=e.length-1;a>=0;--a)for(n=e[a].$layout,t=a-1;t>=0&&n._visible;--t)s=e[t].$layout,s._visible&&n._box.intersects(s._box)&&r(n,s);return e}function na(e){var r,a,t,n,s,o,i;for(r=0,a=e.length;r<a;++r)t=e[r],n=t.$layout,n._visible&&(i=new Proxy(t._el,{get:(l,u)=>l.getProps([u],!0)[u]}),s=t.geometry(),o=He(i,t.model(),s),n._box.update(o,s,t.rotation()));return ra(e,function(l,u){var d=l._hidable,c=u._hidable;d&&c||c?u._visible=!1:d&&(l._visible=!1)})}var X={prepare:function(e){var r=[],a,t,n,s,o;for(a=0,n=e.length;a<n;++a)for(t=0,s=e[a].length;t<s;++t)o=e[a][t],r.push(o),o.$layout={_box:new Ne,_hidable:!1,_visible:!0,_set:a,_idx:o._index};return r.sort(function(i,l){var u=i.$layout,d=l.$layout;return u._idx===d._idx?d._set-u._set:d._idx-u._idx}),this.update(r),r},update:function(e){var r=!1,a,t,n,s,o;for(a=0,t=e.length;a<t;++a)n=e[a],s=n.model(),o=n.$layout,o._hidable=s&&s.display==="auto",o._visible=n.visible(),r|=o._hidable;r&&na(e)},lookup:function(e,r){var a,t;for(a=e.length-1;a>=0;--a)if(t=e[a].$layout,t&&t._visible&&t._box.contains(r))return e[a];return null},draw:function(e,r){var a,t,n,s,o,i;for(a=0,t=r.length;a<t;++a)n=r[a],s=n.$layout,s._visible&&(o=n.geometry(),i=He(n._el,n.model(),o),s._box.update(i,o,n.rotation()),n.draw(e,i))}},sa=function(e){if(K(e))return null;var r=e,a,t,n;if(Tt(e))if(!K(e.label))r=e.label;else if(!K(e.r))r=e.r;else for(r="",a=Object.keys(e),n=0,t=a.length;n<t;++n)r+=(n!==0?", ":"")+a[n]+": "+e[a[n]];return""+r},oa={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:sa,labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},D="$datalabels",qe="$default";function ia(e,r){var a=e.datalabels,t={},n=[],s,o;return a===!1?null:(a===!0&&(a={}),r=J({},[r,a]),s=r.labels||{},o=Object.keys(s),delete r.labels,o.length?o.forEach(function(i){s[i]&&n.push(J({},[r,s[i],{_key:i}]))}):n.push(r),t=n.reduce(function(i,l){return Ot(l.listeners||{},function(u,d){i[d]=i[d]||{},i[d][l._key||qe]=u}),delete l.listeners,i},{}),{labels:n,listeners:t})}function ce(e,r,a,t){if(r){var n=a.$context,s=a.$groups,o;r[s._set]&&(o=r[s._set][s._key],o&&Pe(o,[n,t])===!0&&(e[D]._dirty=!0,a.update(n)))}}function la(e,r,a,t,n){var s,o;!a&&!t||(a?t?a!==t&&(o=s=!0):o=!0:s=!0,o&&ce(e,r.leave,a,n),s&&ce(e,r.enter,t,n))}function ua(e,r){var a=e[D],t=a._listeners,n,s;if(!(!t.enter&&!t.leave)){if(r.type==="mousemove")s=X.lookup(a._labels,r);else if(r.type!=="mouseout")return;n=a._hovered,a._hovered=s,la(e,t,n,s,r)}}function da(e,r){var a=e[D],t=a._listeners.click,n=t&&X.lookup(a._labels,r);n&&ce(e,t,n,r)}var ca={id:"datalabels",defaults:oa,beforeInit:function(e){e[D]={_actives:[]}},beforeUpdate:function(e){var r=e[D];r._listened=!1,r._listeners={},r._datasets=[],r._labels=[]},afterDatasetUpdate:function(e,r,a){var t=r.index,n=e[D],s=n._datasets[t]=[],o=e.isDatasetVisible(t),i=e.data.datasets[t],l=ia(i,a),u=r.meta.data||[],d=e.ctx,c,f,v,h,g,m,M,E;for(d.save(),c=0,v=u.length;c<v;++c)if(M=u[c],M[D]=[],o&&M&&e.getDataVisibility(c)&&!M.skip)for(f=0,h=l.labels.length;f<h;++f)g=l.labels[f],m=g._key,E=new ze(g,d,M,c),E.$groups={_set:t,_key:m||qe},E.$context={active:!1,chart:e,dataIndex:c,dataset:i,datasetIndex:t},E.update(E.$context),M[D].push(E),s.push(E);d.restore(),J(n._listeners,l.listeners,{merger:function(T,R,z){R[T]=R[T]||{},R[T][r.index]=z[T],n._listened=!0}})},afterUpdate:function(e){e[D]._labels=X.prepare(e[D]._datasets)},afterDatasetsDraw:function(e){X.draw(e,e[D]._labels)},beforeEvent:function(e,r){if(e[D]._listened){var a=r.event;switch(a.type){case"mousemove":case"mouseout":ua(e,a);break;case"click":da(e,a);break}}},afterEvent:function(e){var r=e[D],a=r._actives,t=r._actives=e.getActiveElements(),n=V.arrayDiff(a,t),s,o,i,l,u,d,c;for(s=0,o=n.length;s<o;++s)if(u=n[s],u[1])for(c=u[0].element[D]||[],i=0,l=c.length;i<l;++i)d=c[i],d.$context.active=u[1]===1,d.update(d.$context);(r._dirty||n.length)&&(X.update(r._labels),e.render()),delete r._dirty}},Ge={exports:{}};(function(e,r){(function(a,t){e.exports=t()})(Ae,function(){var a={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(t,n,s){var o=n.prototype,i=o.format;s.en.formats=a,o.format=function(l){l===void 0&&(l="YYYY-MM-DDTHH:mm:ssZ");var u=this.$locale().formats,d=function(c,f){return c.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(v,h,g){var m=g&&g.toUpperCase();return h||f[g]||a[g]||f[m].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(M,E,T){return E||T.slice(1)})})}(l,u===void 0?{}:u);return i.call(this,d)}}})})(Ge);var fa=Ge.exports;const ha=Se(fa);var Qe={exports:{}};(function(e,r){(function(a,t){e.exports=t()})(Ae,function(){var a="day";return function(t,n,s){var o=function(u){return u.add(4-u.isoWeekday(),a)},i=n.prototype;i.isoWeekYear=function(){return o(this).year()},i.isoWeek=function(u){if(!this.$utils().u(u))return this.add(7*(u-this.isoWeek()),a);var d,c,f,v,h=o(this),g=(d=this.isoWeekYear(),c=this.$u,f=(c?s.utc:s)().year(d).startOf("year"),v=4-f.isoWeekday(),f.isoWeekday()>4&&(v+=7),f.add(v,a));return h.diff(g,"week")+1},i.isoWeekday=function(u){return this.$utils().u(u)?this.day()||7:this.day(this.day()%7?u:u-7)};var l=i.startOf;i.startOf=function(u,d){var c=this.$utils(),f=!!c.u(d)||d;return c.p(u)==="isoweek"?f?this.date(this.date()-(this.isoWeekday()-1)).startOf("day"):this.date(this.date()-1-(this.isoWeekday()-1)+7).endOf("day"):l.bind(this)(u,d)}}})})(Qe);var va=Qe.exports;const ya=Se(va);_.extend(it);_.extend(Ze);_.extend(ha);_.extend(lt);_.extend(ya);var ba={datetime:"MMM D, YYYY, h:mm:ss a",millisecond:"h:mm:ss.SSS a",second:"h:mm:ss a",minute:"h:mm a",hour:"hA",day:"MMM D",week:"ll",month:"MMM YYYY",quarter:"[Q]Q - YYYY",year:"YYYY"};At._date.override({formats:function(){return ba},parse:function(r,a){var t=typeof r;return r===null||t==="undefined"?null:t==="string"&&typeof a=="string"?_(r,a).isValid()?_(r,a).valueOf():null:r instanceof _?null:_(r).isValid()?_(r).valueOf():null},format:function(r,a){return _(r).format(a)},add:function(r,a,t){return _(r).add(a,t).valueOf()},diff:function(r,a,t){return _(r).diff(_(a),t)},startOf:function(r,a,t){if(a==="isoWeek"){var n=typeof t=="number"&&t>0&&t<7?t:1;return _(r).isoWeekday(n).startOf("day").valueOf()}return _(r).startOf(a).valueOf()},endOf:function(r,a){return _(r).endOf(a).valueOf()}});W.register(...St);const Q={red:"#ff6384",orange:"#ff9f40",yellow:"#ffcd56",green:"#4bc0c0",blue:"#36a2eb",purple:"#9966ff",gray:"#c9cbcf",cinnabar:"#ea4335",palePink:"#f4d8dd",pastelPurple:"#b99fb1",brownSugar:"#b47556",coffee:"#6d4932",gunmetal:"#30313c",armyGreen:"#44501d",coolGrey:"#8898a7",chineseSilver:"#c4d0d2"},$={red:"#ff638480",orange:"#ff9f4080",yellow:"#ffc23380",green:"#4bc0c080",blue:"#37a2eb80",purple:"#9966ff80",gray:"#c9cbcfd9",cinnabar:"#ea433580",palePink:"#f4d8dd80",pastelPurple:"#b99fb180",brownSugar:"#b4755680",coffee:"#6d493280",gunmetal:"#30313c80",armyGreen:"#44501d80",coolGrey:"#8898a780",chineseSilver:"#c4d0d29e"},pa={chineseWhite:"#D5EAE5",columbiaBlue:"#C9DDE7",champagne:"#F4E5CA",palePink:"#F4D8DD",americanSilver:"#CECED0",sunray:"#E9B95E",tealBlue:"#2D6B8E80",skyBlue:"#7BC7EE",pastelYellow:"#F4F497",deepPeach:"#F6C2A6",cottonCandy:"#FBBED6",africanViolet:"#B68EC990",maximumBlueGreen:"#24DAC5",maize:"#F8C058",conditioner:"#FEFFC9",peru:"#C68642"},ma={chineseWhite:"#D5EAE5",columbiaBlue:"#C9DDE7",champagne:"#F4E5CA",palePink:"#F4D8DD",americanSilver:"#CECED0",purple:`${ae.purple}80`,blue:`${ae.blue}80`,gold:`${ae.gold}80`,red:`${ae.red}80`,skyBlue:"#7BC7EE",cottonCandy:"#FBBED6",africanViolet:"#B68EC990",maximumBlueGreen:"#24DAC5",maize:"#F8C058",conditioner:"#FEFFC9",peru:"#C68642"},ke={d:{label:"日",value:"d"},w:{label:"週",value:"w"},m:{label:"月",value:"m"},q:{label:"季",value:"q"},y:{label:"年",value:"y"}},ga="d|w|m|q|y",xa={d:["d","w","m"],w:["d","w","m"],m:["w","m","q","y"],q:["m","q","y"],y:["m","q","y"]},Ca=Array.from(Array(10)).map((e,r)=>r+10);function _a(e){let r="d";return e<=7?r="d":e<=31?r="w":e<=90?r="m":e<=180||e<365?r="q":e>=365&&(r="y"),r}function fe(e,r=$){const a=Object.keys(r);return r[a[e%a.length]]}function ka(e){const r=e instanceof _?e:_.tz(e),a=r.startOf("M").day(),t=r.date()+a;let n=Math.floor(t/7);return t%7!==0&&++n,n}function ee(e,r,a){var l,u,d;const t=Object.keys(e),n=(d=(u=(l=t[0])==null?void 0:l.split)==null?void 0:u.call(l,"/"))==null?void 0:d[0];let s=!0;const o=new Set;let i;return t.forEach((c,f)=>{const v=_.tz(c),[h,g]=c.split("/");let m;switch(r){case"w":{const M=ka(v);m=`${h}/${g}/W${M}`,o.add(m);break}case"m":m=`${h}/${g}月`,o.add(m);break;case"q":{const M=v.quarter();m=`${h}/Q${M}`,o.add(m);break}case"y":{m=h,o.add(m);break}case"d":default:{m=c;break}}h!==n&&(s=!1),a==null||a({day:v,date:c,group:m},f)}),r==="d"?i=t:i=Array.from(o),{labels:s&&n&&r!=="y"?i.map(c=>c.split("/").slice(1).join("/")):i,dates:t}}const Ma={id:"totalizer",beforeUpdate:(e,r,a)=>{const t={};let n=0;a.calculate===!0&&e.data.datasets.forEach((s,o)=>{e.isDatasetVisible(o)&&(n=o,s.data.forEach((i,l)=>{t[l]=(t[l]||0)+i}))}),e.$totalizer={totals:t,utmost:n}}};W.register(Ma);const Ea=I`
  .ant-empty-image {
    height: auto;
    > span {
      background: #efefef2e;
      padding: 40px 0;
      border-radius: 20px;
      width: 100%;
      color: #efefef;
      font-size: 13rem;
    }
  }
`,wa=I`
  font-size: 1.4rem;
  color: #6b6868;
  margin-bottom: 20px;
`,Da=I`
  justify-content: space-between;
  align-items: baseline;
`,Oa=I`
  width: 100%;
  .ant-empty {
    width: 100%;
  }
`;W.register(ca);W.defaults.plugins.legend.position="bottom";W.defaults.plugins.legend.onClick=(e,r,a)=>{const t=r.datasetIndex,{chart:n}=a,s=n.getDatasetMeta(t).hidden===null?!1:n.getDatasetMeta(t).hidden;n.data.datasets.forEach((o,i)=>{const l=n.getDatasetMeta(i);i!==t?s?l.hidden===null&&(l.hidden=!0):l.hidden=l.hidden===null?!l.hidden:null:i===t&&(l.hidden=null)}),n.update()};W.defaults.layout.padding={top:20};const B=b.memo(({dateMap:e,dateType:r="d",title:a,type:t,style:n,color:s="1",allowedDateType:o=ga,displayTypes:i="**|doughnut|table",handle:l})=>{const{getAllCommoditiesInfo:u}=b.useContext(we),[d,c]=b.useState(null),[f=ke[r].value,v]=b.useState(),[h,g]=b.useState(t),m=b.useRef(!1),M=t==="doughnut"||t==="pie",E=M?600:"auto",T=b.useMemo(()=>i&&$t(i.trim().replace("**",t).split("|")).map(C=>({label:Me(C),value:C})),[t,i]),R=b.useMemo(()=>{switch(s){case"orderTypes":return ma;case"2":return pa;case"1":default:return $}},[s]),z=b.useMemo(()=>{switch(t){case"line":return Lt;case"pie":return Nt;case"bubble":return zt;case"doughnut":return jt;case"bar":default:return Wt}},[t]),H=b.useMemo(()=>Me(t),[t]),w=b.useMemo(()=>{if(o&&e){const C=o.trim().split("|");return Rt(C.concat(xa[r]),(O,j,N)=>Pt(N,O,j+1)).map(O=>ke[O.trim()])}return[]},[e,r,o]),p=b.useCallback(C=>{g(C)},[]),x=b.useCallback(C=>{v(C)},[]);return b.useEffect(()=>{w.length&&!w.some(({value:C})=>C===f)&&(m.current=!0,v(w[0].value))},[w,f]),b.useEffect(()=>{const C=async()=>{const{resMapGroup:A}=await u(),O=await(l==null?void 0:l(e,h,f,R,A));O&&c(O)};!m.current&&C(),m.current=!1},[e,l,f,h,R,u]),S("div",{css:Ea,children:[S(U,{css:Da,children:[S($e,{css:wa,children:[H,y("label",{children:a})]}),T&&d&&y(ge,{options:T,value:h,onChange:p}),o?y(ge,{options:w,value:f,onChange:x}):y("div",{style:{width:112}})]}),y(U,{css:Oa,align:M&&"center",style:{height:E,...n},vertical:!0,children:d?y(z,{options:d.options,data:d.data}):y(ut,{description:!1,image:H})})]})});function Me(e){switch(e){case"line":return y(ft,{});case"doughnut":case"pie":return y(ct,{});case"table":return y(dt,{});case"bar":default:return y(Re,{})}}function Ta(e,r,a){if(!e)return null;const t=[{label:"上午",data:[],backgroundColor:$.yellow,stack:"stack 0"},{label:"下午",data:[],backgroundColor:$.blue,stack:"stack 0"}],n={},s={},o={},{labels:i}=ee(e,a,({date:u,group:d})=>{const{records:c,dailyData:f}=e[u];c.forEach(({total:v,$isAM:h})=>{h?s[d]=(s[d]??0)+v:o[d]=(o[d]??0)+v}),n[d]=(n[d]??0)+f.total}),l=Object.values(n);return t[0].data=Object.values(s),t[1].data=Object.values(o),{options:{responsive:!0,scales:{x:{stacked:!0},y:{stacked:!0}},plugins:{datalabels:{anchor:"end",align:"end",formatter(u,d){const c=l[d.dataIndex];return De(c)},display(u){return u.datasetIndex===1}}}},data:{labels:i,datasets:t}}}function Aa(e,r,a){if(!e)return null;const t=[{label:"營收",data:[],backgroundColor:$.orange},{label:"成本",data:[],backgroundColor:$.chineseSilver},{label:"淨利",data:[],backgroundColor:$.green}],n={},{labels:s}=ee(e,a,({date:i,group:l})=>{const{records:u,dailyData:d}=e[i];u.forEach(({total:c,$isAM:f})=>{}),n[l]=(n[l]??0)+d.total}),o=Object.values(n);return t[0].data=o,t[1].data=[],t[2].data=o,{options:{responsive:!0,plugins:{datalabels:{anchor:"end",align:"end",formatter(i){return De(i)}}}},data:{labels:s,datasets:t}}}function Sa(e,r){if(!e)return null;const a=(i,l)=>i.p0.skip||i.p1.skip?l:void 0,t=(i,l,u)=>(i!=null&&i.p0DataIndex?i.p0DataIndex:i.dataIndex)>=6?l:u,n=[{label:"營業時間",data:[],backgroundColor:i=>t(i,$.blue,$.yellow),borderColor:i=>t(i,Q.blue,Q.yellow),pointStyle:"circle",pointRadius:10,pointHoverRadius:15,segment:{pointBackgroundColor:i=>t(i,$.blue),pointBorderColor:i=>t(i,Q.blue),borderColor:i=>a(i,Q.gray)||t(i,Q.blue),borderDash:i=>a(i,[6,6])},spanGaps:!0}],s=[...Ca].map(i=>i===14||i===15?`午休 (${pe(i,!0)})`:pe(i,!0));return Object.keys(e).forEach(i=>{const{records:l}=e[i];l.forEach(({createdAt:u})=>{const f=_.tz(u).hour()-10;if(f>-1){const v=n[0].data;v[f]=v[f]??0,++v[f]}})}),n[0].data[4]=NaN,n[0].data[5]=NaN,{options:{responsive:!0,scales:{x:{stacked:!0},y:{stacked:!0}},plugins:{totalizer:{calculate:!0},datalabels:{anchor:"end",align:"end",formatter(i){return`${i} 人`}}},fill:!1,interaction:{intersect:!1},radius:0},data:{labels:s,datasets:n}}}function $a(e,r,a,t,n,s){if(!r)return null;const o={},{labels:i}=ee(r,t,({date:u,group:d})=>{const{records:c}=r[u];c.forEach(({data:f})=>{f.forEach(({res:v,type:h})=>{h===e&&(o[v]=o[v]??{},o[v][d]=(o[v][d]??0)+1)})})}),l=s[e].map((u,d)=>({label:u,data:Object.values(o[u]??{}),backgroundColor:fe(d,n),stack:"stack 0",datalabels:{formatter(c,f){let v=0;return f.chart.data.datasets.forEach(g=>{v+=g.data[f.dataIndex]??0}),`${(c/v*100).toFixed(1)}%`}}}));return l.push({label:"Total",data:[...Array.from(Array(i.length)).map(()=>0)],datalabels:{align:"end",anchor:"end",formatter(u,d){let c=0;return d.chart.data.datasets.forEach(f=>{c+=f.data[d.dataIndex]??0}),Oe(c)}},stack:"stack 0"}),{options:{responsive:!0,scales:{x:{stacked:!0},y:{stacked:!0}},plugins:{tooltip:{callbacks:{label(u){return`${u.dataset.label+": "||""}${u.parsed.y}份`}}}}},data:{labels:i,datasets:l}}}function de(e){return b.useMemo(()=>$a.bind(null,e),[e])}function Ra(e,r,a,t){if(!e)return null;const n={},{labels:s}=ee(e,a,({date:i,group:l})=>{const{records:u}=e[i];u.forEach(({memo:d})=>{d!=null&&d.length&&d.forEach(c=>{n[c]=n[c]??{},n[c][l]=(n[c][l]??0)+1})})}),o=et.map(({name:i},l)=>({label:i,data:Object.values(n[i]??{}),backgroundColor:fe(l,t),stack:"stack 0",datalabels:{formatter(u,d){let c=0;return d.chart.data.datasets.forEach(v=>{c+=v.data[d.dataIndex]??0}),`${(u/c*100).toFixed(1)}%`}}}));return o.push({label:"Total",data:[...Array.from(Array(s.length)).map(()=>0)],backgroundColor:"#7BC7EE",datalabels:{align:"end",anchor:"end",formatter(i,l){let u=0;return l.chart.data.datasets.forEach(d=>{u+=d.data[l.dataIndex]??0}),Oe(u)}},stack:"stack 0"}),{options:{indexAxis:"y",responsive:!0,scales:{x:{stacked:!0},y:{stacked:!0}}},data:{labels:s,datasets:o}}}function Pa(e,r,a,t,n){if(!e)return null;const s=[],o=[...n["main-dish"]];ee(e,a,({date:l})=>{const{records:u}=e[l];u.forEach(({data:d,memo:c})=>{c!=null&&c.length&&!c.includes("外送")||d.forEach(({res:f,type:v})=>{if(v==="main-dish"){const h=o.indexOf(f);h>-1&&(s[h]=(s[h]??0)+1)}})})});const i=[{data:s,backgroundColor:o.map((l,u)=>fe(u,t)),datalabels:{formatter(l){if(l===void 0)return"";const u=s.reduce((c,f)=>c+f,0),d=(l/u*100).toFixed(1);return`${l}份 (${d}%)`}}}];return{options:{responsive:!0,plugins:{tooltip:{callbacks:{label(l){return`${l.parsed}份`}}}}},data:{labels:o,datasets:i}}}const Ia=I`
  padding: 20px;
  padding-bottom: 80px;
`,Ya=I`
  margin-bottom: 20px;
  font-size: 1.4rem;
  color: #6b6868;
  padding: 10px 20px;

  .ant-picker {
    margin-left: 30px;
    margin-right: 20px;
  }
`,Fa=I`
  vertical-align: middle;
`,Ba=I`
  .ant-flex {
    margin-bottom: 20px;
    justify-content: space-around;
  }

  .ant-statistic {
    text-align: center;
  }

  .ant-statistic-title {
    color: #858585;
    font-size: 1.1rem;
    border-bottom: 1px solid #d3cdcd;
    padding-bottom: 4px;
  }
`,L=I`
  ${tt({rtColor:"#FBD28E",rbColor:"#B2E9E6",lbColor:"#FCD5C2",ltColor:"#FFBBBA"})}
`,{RangePicker:La}=vt,Ee={},Qa=b.memo(()=>{const{API:e}=b.useContext(we),r=_.tz(),a=r.format(me),[t,n]=b.useState(()=>[r.startOf("day"),r.endOf("day")]),[s,o]=b.useState("今天"),[i,l,u]=b.useMemo(()=>{if(!(t!=null&&t.length))return[null,null,void 0];const p=t.map(A=>A.valueOf()),x=Math.abs(t[0].diff(t[1],"day")),C=_a(x);return[...p,C]},[t]),d=b.useMemo(()=>{const p=r.startOf("day"),x=r.endOf("day"),C=p.add(-1,"d"),A=p.quarter()>2;return[{label:"今天",value:[p,x]},{label:"昨天",value:[C,C.endOf("day")]},{label:"2天內",value:[C,x]},{label:"本週",value:[p.day(1),x]},{label:"上週",value:[p.add(-7,"d").day(1),x.add(-7,"d").day(5)]},{label:"2週內",value:[p.add(-14,"d").day(1),x]},{label:"本月",value:[p.startOf("M"),x]},{label:"上個月",value:[p.add(-1,"M").startOf("M"),x.add(-1,"M").endOf("M")]},{label:"2月內",value:[p.add(-1,"M").startOf("M"),x]},{label:"本季",value:[p.startOf("Q"),x]},{label:"上季",value:[p.add(-1,"Q").startOf("Q"),x.add(-1,"Q").endOf("Q")]},{label:"上半年",value:[p.startOf("y"),p.month(5).endOf("M")]},A?{label:"下半年",value:[p.month(6).startOf("M"),x.endOf("y")]}:null,{label:"今年",value:[p.startOf("y"),x.endOf("y")]},{label:"去年",value:[p.add(-1,"y").startOf("y"),x.add(-1,"y").endOf("y")]},{label:"2年內",value:[p.add(-1,"y"),x]}].filter(O=>O)},[a]),c=b.useCallback(p=>{if(p){const[x,C]=p;d.some(({label:O,value:j})=>{const N=j[0].valueOf()===x.valueOf()&&j[1].valueOf()===C.valueOf();return N&&o(O),N})||o(""),n(p)}},[d]),{records:f,dailyDataInfo:v}=at(async()=>!i||!l?Ee:await e.statistics.get(i,l),[i,l],Ee),h=b.useMemo(()=>{if(!f||!v)return{incomeTotal:null,incomeAMTotal:null,incomePMTotal:null,recordsCount:null,resCount:null,mainDishCount:null,profits:null,cost:null,dateMap:null};const p={};let x=0,C=0,A=0,O=0,j=0,N=0,Ue=0;return v.forEach(q=>{const{date:te,total:ie}=q;x+=ie,p[te]=p[te]??{records:[],dailyData:q}}),f.forEach(q=>{const{createdAt:te,data:ie,total:he}=q,le=_.tz(te),Ke=le.format(me),ve=rt(le.hour(),le.minute())==="AM";ve?C+=he:A+=he,ie.forEach(({res:Ve,type:Xe,amount:Je})=>{const be=nt(Je);Ve&&(Xe==="main-dish"&&(j+=be),O+=be)});const ye=q;ye.$isAM=ve,p[Ke].records.push(ye)}),{incomeTotal:x,incomeAMTotal:C,incomePMTotal:A,resCount:O,mainDishCount:j,profits:N,cost:Ue,recordsCount:(f==null?void 0:f.length)??0,dateMap:p}},[f,v]),{incomeTotal:g,profits:m,cost:M,recordsCount:E,incomeAMTotal:T,incomePMTotal:R,resCount:z,mainDishCount:H,dateMap:w}=h;return S(ot,{children:[S(yt,{cls:Ya,children:[S($e,{css:Fa,children:[y(Re,{}),y("label",{children:"統計報表"})]}),y(La,{showNow:!0,inputReadOnly:!0,presets:d,format:st,placeholder:["開始日期","結束日期"],size:"large",value:t,onChange:c}),y("label",{children:s&&`(${s})`})]}),S(U,{css:Ia,vertical:!0,gap:40,children:[S("div",{css:Ba,children:[S(U,{children:[y("div",{css:L,children:y(Y,{title:"總營業額 (含修正)",prefix:F(g)?"":"$",value:g??"---"})}),y("div",{css:L,children:y(Y,{title:"淨利",prefix:F(m)?"":"$",value:m??"---"})}),y("div",{css:L,children:y(Y,{title:"成本",prefix:F(M)?"":"$",value:M??"---"})}),y("div",{css:L,children:y(Y,{title:"訂單數量",prefix:F(E)?"":"$",value:E??"---"})})]}),S(U,{children:[y("div",{css:L,children:y(Y,{title:"上午營業額",prefix:F(T)?"":"$",value:T??"---"})}),y("div",{css:L,children:y(Y,{title:"下午營業額",prefix:F(R)?"":"$",value:R??"---"})}),y("div",{css:L,children:y(Y,{title:"銷售便當數量",prefix:F(H)?"":"$",value:H??"---"})}),y("div",{css:L,children:y(Y,{title:"銷售商品數量",prefix:F(z)?"":"$",value:z??"---"})})]})]}),y(B,{type:"bar",title:"營收分析",dateMap:w,dateType:u,handle:Ta}),y(B,{type:"bar",title:"淨利分析",dateMap:w,dateType:u,handle:Aa}),y(B,{type:"line",title:"客流量分析 (總計)",dateMap:w,dateType:u,allowedDateType:null,handle:Sa}),y(B,{type:"bar",title:"便當銷售分析",dateMap:w,dateType:u,handle:de("main-dish")}),y(B,{type:"bar",title:"單點銷售分析",dateMap:w,dateType:u,color:"2",handle:de("à-la-carte")}),y(B,{type:"bar",title:"零售銷售分析",dateMap:w,dateType:u,handle:de("others")}),y(B,{type:"bar",title:"訂單備註分析",dateMap:w,dateType:u,color:"orderTypes",handle:Ra}),y(B,{type:"doughnut",title:"送外訂單分析",dateMap:w,dateType:u,allowedDateType:null,handle:Pa}),y(ht.BackTop,{visibilityHeight:100})]})]})});export{Qa as Component,Qa as Statistics,Qa as default};
