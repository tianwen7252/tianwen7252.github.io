import{A as Se,O as U,D as f,u as ye,j as n,a,h as De,s as Oe,m as ve,d as G,F as Y,b as ke,t as we,c as Te,k as Ee,K as Re,e as Ae,f as _e,l as xe}from"./index-D6OYzFC2.js";import{r as e}from"./react-DQrQyBkK.js";import{b as S,S as J,B as y,H as Ie,i as c,h as Pe,z as ze,J as Fe,m as D,C as Z,j as Ke,P as Me,F as Be,K as Le}from"./antd-CsVyReHd.js";import{S as Ne}from"./StickyHeader-KX7zxFTT.js";import{d as C}from"./lodash-EY-pETZd.js";import"./mathjs-FsHcr6tf.js";const{RangePicker:je}=Le,Ze=()=>{var L,N,j;const[r,O]=e.useState(),[v,k]=e.useState([]),[d,w]=e.useState(0),[u,T]=e.useState(0),[h,E]=e.useState(0),[R,A]=e.useState(!1),[_,x]=e.useState(!1),[I,q]=e.useState(!1),[Q,V]=e.useState(!0),[P,W]=e.useState(0),[z,F]=e.useState(""),{appEvent:i}=e.useContext(Se),m=!(r!=null&&r.length),b=e.useMemo(()=>{const t=S.tz(),s=t.startOf("day"),l=t.endOf("day"),o=s.add(-1,"d");return[{label:"今天",value:[s,l]},{label:"昨天",value:[o,o.endOf("day")]},{label:"2天內",value:[o,l]},{label:"7天前",value:[s.add(-7,"d"),l]},{label:"14天內",value:[s.add(-14,"d"),l]},{label:"1個月內",value:[s.add(-30,"d"),l]}]},[]),X=e.useCallback(()=>{A(!0)},[]),ee=e.useCallback(()=>{A(!1)},[]),K=e.useCallback(()=>{document.body.classList.add("resta--hidden-scroll"),x(!0)},[]),M=e.useCallback(()=>{document.body.classList.remove("resta--hidden-scroll"),x(!1),i.fire(i.ORDER_AFTER_ACTION)},[i]),te=e.useCallback(t=>{if(t){const[s,l]=t;b.some(({label:g,value:$})=>{const H=$[0].valueOf()===s.valueOf()&&$[1].valueOf()===l.valueOf();return H&&F(g),H})||F(""),O(t)}},[b]),ae=e.useCallback(C(t=>{k(t)},300),[]),re=e.useCallback(C(t=>{w(t)},500),[]),se=e.useCallback(C(t=>{T(t)}),[]),le=e.useCallback(C(t=>{E(t)}),[]),ne=e.useCallback(()=>{q(t=>!t)},[]),oe=e.useCallback(()=>{V(t=>!t)},[]),ce=e.useCallback(t=>{W((t-1)*U)},[]),ie=e.useCallback((t,{from:s})=>s?Math.abs(t.diff(s,"day"))>31:!1,[]),de=e.useCallback(()=>{O([]),k([]),w(0),T(0),E(0)},[]),p=e.useRef({}),ue=e.useCallback(t=>(p.current={},t.filter(({total:s,createdAt:l})=>{const o=S.tz(l).format(f),g=p.current[o]=p.current[o]??{ordersSum:0,total:0};return g.total+=s,++g.ordersSum,!(d&&d&&s<d)}).filter(({createdAt:s})=>{if(u||h){const l=S.tz(s).format(f),o=p.current[l];if(o&&(u&&o.total<u||h&&o.ordersSum<h))return!1}return!0})),[d,u,h]),he=e.useMemo(()=>{var t;return(t=r==null?void 0:r.map)==null?void 0:t.call(r,s=>s.valueOf())},[r]),{periodsOrder:B,orderListElement:fe,anchorElement:me,summaryElement:pe,totalDays:ge,callOrderAPI:Ce}=ye({datetime:r!=null&&r.length?he:"today",searchData:v,dateOrder:Q,searchUI:!1,reverse:!1,offset:P,handleRecords:ue});e.useEffect(()=>{const t=i.on(i.KEYBOARD_ON_ACTION,s=>{const{action:l}=s.detail;l==="edit"&&K()});return()=>t()},[i,K]),e.useEffect(()=>{setTimeout(()=>{window.scroll({top:0,left:0,behavior:"smooth"})},200)},[P]),e.useEffect(()=>()=>{window.scroll({top:0,left:0,behavior:"smooth"})},[]);const be=B.length;return n(Y,{children:[a(Ne,{cls:De,children:n(J,{size:60,children:[a(y,{css:Oe,type:"text",icon:a(Ie,{}),onClick:X,children:"訂單搜尋"}),n("h2",{children:[be===1?((L=r==null?void 0:r[0])==null?void 0:L.format(f))??B[0]:[(N=r==null?void 0:r[1])==null?void 0:N.format(f),(j=r==null?void 0:r[0])==null?void 0:j.format(f)].join(" ~ "),z?` (${z})`:" (今天)"]})]})}),n(c,{css:ve,gap:"middle",vertical:!0,children:[a(Z,{css:G,rootClassName:"resta-orderlist-search-drawer",title:a(Y,{children:a(y,{icon:a(Pe,{}),type:"text",onClick:de,children:"重設"})}),getContainer:!1,placement:"left",open:R,mask:!0,onClose:ee,children:n(c,{vertical:!0,gap:"large",children:[n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"日期"}),a(je,{showNow:!0,inputReadOnly:!0,presets:b,showTime:I,format:ke,placeholder:["開始日期","結束日期"],size:"large",value:r,disabledDate:ie,onChange:te,renderExtraFooter:()=>a(y,{css:we,type:"text",onClick:ne,children:I?"關閉時間":"指定時間"})})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"關鍵字"}),a(ze,{placeholder:"找什麼呢?",mode:"tags",size:"large",style:{width:"100%"},allowClear:!0,onKeyUp:t=>{t.preventDefault(),t.stopPropagation()},options:Te,disabled:m,value:v,onChange:ae})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"日期排序"}),a(Fe,{checkedChildren:"反序",unCheckedChildren:"正序",defaultChecked:!0,onChange:oe})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"單筆金額大於"}),a(D,{size:"large",type:"number",prefix:"$",style:{width:"60%"},disabled:m,value:d,onChange:re})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"當日營業額大於"}),a(D,{size:"large",type:"number",prefix:"$",style:{width:"60%"},disabled:m,value:u,onChange:se})]}),n(c,{vertical:!0,gap:"large",children:[a("h2",{children:"當日訂單數量大於"}),a(D,{size:"large",type:"number",style:{width:"60%"},disabled:m,value:h,onChange:le})]})]})}),a(Z,{css:[G,Ee],title:n(J,{children:[a(Ke,{}),a("label",{children:"編輯訂單"})]}),placement:"right",open:_,mask:!0,onClose:M,width:820,forceRender:!0,children:a(Re,{drawerMode:!0,callOrderAPI:Ce,submitCallback:M})}),n("div",{css:[Ae,(R||_)&&_e],children:[me,a("div",{css:xe,children:pe}),a(c,{wrap:!0,children:fe}),a(Me,{hideOnSinglePage:!0,total:ge,defaultPageSize:U,onChange:ce})]}),a(Be.BackTop,{visibilityHeight:100})]})]})};export{Ze as Component,Ze as OrderList,Ze as default};
